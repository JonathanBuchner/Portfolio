!function(e){var t=function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){return r(t[s][1][e]||e)},l,l.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";t.exports=WebSocket},{}],2:[function(e,t,n){"use strict";t.exports={XMLHttpRequest:XMLHttpRequest}},{}],3:[function(e,t,n){n.Device=e("./twilio/device").Device,n.PStream=e("./twilio/pstream").PStream,n.Connection=e("./twilio/connection").Connection},{"./twilio/connection":5,"./twilio/device":7,"./twilio/pstream":11}],4:[function(e,t,n){var i=e("events").EventEmitter,r=e("util").inherits,o=e("./log"),s=e("./shims/mediadeviceinfo"),a=e("./shims/mediadevices"),c=e("./outputdevicecollection"),u=e("./util");function l(e,t,n,r){if(!(this instanceof l))return new l(e,t,n,r);i.call(this),r=Object.assign({AudioContext:"undefined"!=typeof AudioContext&&AudioContext,mediaDevices:a,setSinkId:"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId},r),o.mixinLog(this,"[AudioHelper]"),this.log.enabled=r.logEnabled,this.log.warnings=r.logWarnings;var s,u,p=new Map,f=new Map,h=r.mediaDevices,m=h&&h.enumerateDevices||!1,v=m&&"function"==typeof r.setSinkId,g=!(!r.AudioContext&&!r.audioContext);r.enabledSounds&&(s=this,u=r.enabledSounds,Object.keys(u).forEach(function(e){s[e]=(function(e,t){return void 0!==t&&(u[e]=t),u[e]}).bind(null,e)}));var y=null,_=null;g&&((_=(y=r.audioContext||new r.AudioContext).createAnalyser()).fftSize=32,_.smoothingTimeConstant=.3);var b,w=this;Object.defineProperties(this,{_audioContext:{value:y},_getUserMedia:{value:n},_inputDevice:{value:null,writable:!0},_inputStream:{value:null,writable:!0},_inputVolumeAnalyser:{value:_},_isPollingInputVolume:{value:!1,writable:!0},_onActiveInputChanged:{value:t},_mediaDevices:{value:h},_unknownDeviceIndexes:{value:{}},_updateAvailableDevices:{value:d.bind(null,this)},availableInputDevices:{enumerable:!0,value:p},availableOutputDevices:{enumerable:!0,value:f},inputDevice:{enumerable:!0,get:function(){return w._inputDevice}},inputStream:{enumerable:!0,get:function(){return w._inputStream}},isVolumeSupported:{enumerable:!0,value:g},isOutputSelectionSupported:{enumerable:!0,value:v},ringtoneDevices:{enumerable:!0,value:new c("ringtone",f,e,v)},speakerDevices:{enumerable:!0,value:new c("speaker",f,e,v)}}),this.on("newListener",function(e){"inputVolume"===e&&w._maybeStartPollingVolume()}),this.on("removeListener",function(e){"inputVolume"===e&&w._maybeStopPollingVolume()}),this.once("newListener",function(){v||console.warn("Warning: This browser does not support audio output selection."),g||console.warn("Warning: This browser does not support Twilio's volume indicator feature.")}),m&&((b=this)._mediaDevices.addEventListener("devicechange",b._updateAvailableDevices),b._mediaDevices.addEventListener("deviceinfochange",b._updateAvailableDevices),d(b).then(function(){b.isOutputSelectionSupported&&Promise.all([b.speakerDevices.set("default"),b.ringtoneDevices.set("default")]).catch(function(e){b.log.warn("Warning: Unable to set audio output devices. "+e)})}))}function d(e){return e._mediaDevices.enumerateDevices().then(function(t){v(e,h(t,"audiooutput"),e.availableOutputDevices,p),v(e,h(t,"audioinput"),e.availableInputDevices,f);var n=e.availableOutputDevices.get("default")||Array.from(e.availableOutputDevices.values())[0];[e.speakerDevices,e.ringtoneDevices].forEach(function(t){!t.get().size&&e.availableOutputDevices.size&&t.set(n.deviceId)})})}function p(e,t){return e.speakerDevices._delete(t)|e.ringtoneDevices._delete(t)}function f(e,t){if(!e.inputDevice||e.inputDevice.deviceId!==t.deviceId)return!1;y(e,null),e._inputDevice=null,e._maybeStopPollingVolume();var n=e.availableInputDevices.get("default")||Array.from(e.availableInputDevices.values())[0];return n&&e.setInputDevice(n.deviceId),!0}function h(e,t){return e.filter(function(e){return e.kind===t})}function m(e){return e.deviceId}function v(e,t,n,i){var r=t.map(m),o=Array.from(n.values()).map(m),a=[],c=u.difference(o,r);c.forEach(function(t){var r=n.get(t);n.delete(t),i(e,r)&&a.push(r)});var l=!1;t.forEach(function(t){var i=n.get(t.deviceId),r=function(e,t){var n={deviceId:t.deviceId,groupId:t.groupId,kind:t.kind,label:t.label};if(!n.label)if("default"===n.deviceId)n.label="Default";else{var i=function(e,t){var n=t.deviceId,i=t.kind,r=e._unknownDeviceIndexes;r[i]||(r[i]={});var o=r[i][n];return o||(o=Object.keys(r[i]).length+1,r[i][n]=o),o}(e,t);n.label="Unknown "+g[n.kind]+" Device "+i}return new s(n)}(e,t);i&&i.label===r.label||(n.set(t.deviceId,r),l=!0)}),(l||c.length)&&(null!==e.inputDevice&&"default"===e.inputDevice.deviceId&&(e.log.warn(["Calling getUserMedia after device change to ensure that the","tracks of the active device (default) have not gone stale."].join(" ")),e._setInputDevice(e._inputDevice.deviceId,!0)),e.emit("deviceChange",a))}r(l,i),l.prototype._maybeStartPollingVolume=function(){if(this.isVolumeSupported&&this._inputStream&&(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),this._inputVolumeSource=null),this._inputVolumeSource=this._audioContext.createMediaStreamSource(this._inputStream),this._inputVolumeSource.connect(this._inputVolumeAnalyser),!this._isPollingInputVolume)){var e=new Uint8Array(this._inputVolumeAnalyser.frequencyBinCount),t=this;this._isPollingInputVolume=!0,requestAnimationFrame(function n(){if(t._isPollingInputVolume){t._inputVolumeAnalyser.getByteFrequencyData(e);var i=u.average(e);t.emit("inputVolume",i/255),requestAnimationFrame(n)}})}},l.prototype._maybeStopPollingVolume=function(){this.isVolumeSupported&&(!this._isPollingInputVolume||this._inputStream&&this.listenerCount("inputVolume")||(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),this._inputVolumeSource=null),this._isPollingInputVolume=!1))},l.prototype.setInputDevice=function(e){return u.isFirefox()?Promise.reject(new Error("Firefox does not currently support opening multiple audio input tracks simultaneously, even across different tabs. As a result, Device.audio.setInputDevice is disabled on Firefox until support is added.\nRelated BugZilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324")):this._setInputDevice(e,!1)},l.prototype._setInputDevice=function(e,t){if("string"!=typeof e)return Promise.reject(new Error("Must specify the device to set"));var n=this.availableInputDevices.get(e);if(!n)return Promise.reject(new Error("Device not found: "+e));if(this._inputDevice&&this._inputDevice.deviceId===e&&this._inputStream){if(!t)return Promise.resolve();this._inputStream.getTracks().forEach(function(e){e.stop()})}var i=this;return this._getUserMedia({audio:{deviceId:{exact:e}}}).then(function(e){return i._onActiveInputChanged(e).then(function(){y(i,e),i._inputDevice=n,i._maybeStartPollingVolume()})})},l.prototype.unsetInputDevice=function(){if(!this.inputDevice)return Promise.resolve();var e=this;return this._onActiveInputChanged(null).then(function(){y(e,null),e._inputDevice=null,e._maybeStopPollingVolume()})},l.prototype._unbind=function(){this._mediaDevices.removeEventListener("devicechange",this._updateAvailableDevices),this._mediaDevices.removeEventListener("deviceinfochange",this._updateAvailableDevices)};var g={audiooutput:"Audio Output",audioinput:"Audio Input"};function y(e,t){e._inputStream&&e._inputStream.getTracks().forEach(function(e){e.stop()}),e._inputStream=t}t.exports=l},{"./log":9,"./outputdevicecollection":10,"./shims/mediadeviceinfo":22,"./shims/mediadevices":23,"./util":26,events:39,util:50}],5:[function(e,t,n){var i=e("./constants"),r=e("events").EventEmitter,o=e("./util").Exception,s=e("./log"),a=e("./rtc"),c=e("./rtc/monitor"),u=10,l=20,d=[1,2,3,4,5],p=["one-way-audio","choppy-audio","dropped-call","audio-latency","noisy-call","echo"],f={audioOutputLevel:"audio-output-level",audioInputLevel:"audio-input-level",packetsLostFraction:"packet-loss",jitter:"jitter",rtt:"rtt",mos:"mos"},h={min:"low-",max:"high-",maxDuration:"constant-"};function m(e,t,n,r){if(!(this instanceof m))return new m(e,t,n,r);var o=this;function d(){}this._soundcache=e.soundcache,this.message=t||{},r=this.options=Object.assign({audioConstraints:e.options.audioConstraints,callParameters:{},debug:!1,iceServers:e.options.iceServers,logPrefix:"[Connection]",MediaStream:r.mediaStreamFactory||e.options.MediaStream||e.options.mediaStreamFactory||a.PeerConnection,offerSdp:null,rtcConstraints:e.options.rtcConstraints},r),this.parameters=r.callParameters,this._status="pending",this._isAnswered=!1,this._direction=this.parameters.CallSid?"INCOMING":"OUTGOING",this.sendHangup=!0,s.mixinLog(this,this.options.logPrefix),this.log.enabled=this.options.debug,this.log.warnings=this.options.warnings,this._onCancel=d,this._onHangup=d,this._onAnswer=this._onAnswer.bind(this),this._onRinging=this._onRinging.bind(this);var p=this._publisher=r.publisher;"INCOMING"===this._direction&&p.info("connection","incoming",null,this);var g=this._monitor=new c;g.disableWarnings();var y=[];function _(){var t;0!==y.length&&p.postMetrics("quality-metrics-samples","metrics-sample",y.splice(0),(t={call_sid:o.parameters.CallSid,sdk_version:i.RELEASE_VERSION,selected_region:e.options.region},e.stream&&(e.stream.gateway&&(t.gateway=e.stream.gateway),e.stream.region&&(t.region=e.stream.region)),t.direction=o._direction,t)).catch(function(e){o.log.warn("Unable to post metrics to Insights. Received error:",e)})}var b=0;function w(e,t){var n=(/^audio/.test(t.name)?"audio-level-":"network-quality-")+"warning"+(e?"-cleared":"-raised"),i=h[t.threshold.name]+f[t.name];if("constant-audio-input-level"!==i||!o.isMuted()){var r=e?"info":"warning";"constant-audio-output-level"===i&&(r="info"),p.post(r,n,i,function(e){var t={threshold:e.threshold.value};return e.values?t.values=e.values.map(function(e){return"number"==typeof e?Math.round(100*e)/100:e}):e.value&&(t.value=e.value),{data:t}}(t),o),"constant-audio-output-level"!==i&&o.emit(e?"warning-cleared":"warning",i)}}return g.on("sample",function(e){b<l?b++:b===l&&g.enableWarnings(),e.inputVolume=o._latestInputVolume,e.outputVolume=o._latestOutputVolume,y.push(e),y.length>=u&&_()}),g.on("warning-cleared",w.bind(null,!0)),g.on("warning",w.bind(null,!1)),this.mediaStream=new this.options.MediaStream(e,n),this.on("volume",function(e,t){o._latestInputVolume=e,o._latestOutputVolume=t}),this.mediaStream.onvolume=this.emit.bind(this,"volume"),this.mediaStream.oniceconnectionstatechange=function(e){p.post("failed"===e?"error":"debug","ice-connection-state",e,null,o)},this.mediaStream.onicegatheringstatechange=function(e){p.debug("signaling-state",e,null,o)},this.mediaStream.onsignalingstatechange=function(e){p.debug("signaling-state",e,null,o)},this.mediaStream.ondisconnect=function(e){o.log(e),p.warn("network-quality-warning-raised","ice-connectivity-lost",{message:e},o),o.emit("warning","ice-connectivity-lost")},this.mediaStream.onreconnect=function(e){o.log(e),p.info("network-quality-warning-cleared","ice-connectivity-lost",{message:e},o),o.emit("warning-cleared","ice-connectivity-lost")},this.mediaStream.onerror=function(e){!0===e.disconnect&&o._disconnect(e.info&&e.info.message);var t={code:e.info.code,message:e.info.message||"Error with mediastream",info:e.info,connection:o};o.log("Received an error from MediaStream:",e),o.emit("error",t)},this.mediaStream.onopen=function(){"open"!==o._status&&("ringing"===o._status||"connecting"===o._status?(o.mute(!1),o._maybeTransitionToOpen()):o.mediaStream.close())},this.mediaStream.onclose=function(){o._status="closed",e._enabledSounds.disconnect&&e.soundcache.get("disconnect").play(),g.disable(),_(),o.emit("disconnect",o)},this.outboundConnectionId="TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),this.pstream=e.stream,this._onCancel=function(e){o.parameters.CallSid===e.callsid&&(o._status="closed",o.emit("cancel"),o.pstream.removeListener("cancel",o._onCancel))},this.pstream&&(this.pstream.on("cancel",this._onCancel),this.pstream.on("ringing",this._onRinging)),this.on("error",function(e){p.error("connection","error",{code:e.code,message:e.message},o),o.pstream&&"disconnected"===o.pstream.status&&v(o)}),this.on("disconnect",function(){v(o)}),this}function v(e){function t(){e.pstream&&(e.pstream.removeListener("answer",e._onAnswer),e.pstream.removeListener("cancel",e._onCancel),e.pstream.removeListener("hangup",e._onHangup),e.pstream.removeListener("ringing",e._onRinging))}t(),setTimeout(t,0)}e("util").inherits(m,r),m.toString=function(){return"[Twilio.Connection class]"},m.prototype.toString=function(){return"[Twilio.Connection instance]"},m.prototype.sendDigits=function(e){if(e.match(/[^0-9*#w]/))throw new o("Illegal character passed into sendDigits");var t=[];e.split("").forEach(function(e){var n="w"!==e?"dtmf"+e:"";"dtmf*"===n&&(n="dtmfs"),"dtmf#"===n&&(n="dtmfh"),t.push(n)}),function e(n){var i=t.shift();n.get(i).play(),t.length&&setTimeout(e.bind(null,n),200)}(this._soundcache);var n,i=this.mediaStream.getOrCreateDTMFSender();if(i){if(!("canInsertDTMF"in i)||i.canInsertDTMF)return this.log("Sending digits using RTCDTMFSender"),void function e(t){if(t.length){var n=t.shift();n.length&&i.insertDTMF(n,160,70),setTimeout(e.bind(null,t),500)}}(e.split("w"));this.log("RTCDTMFSender cannot insert DTMF")}this.log("Sending digits over PStream"),null!==this.pstream&&"disconnected"!==this.pstream.status?this.pstream.publish("dtmf",n={dtmf:e,callsid:this.parameters.CallSid}):this.emit("error",{code:(n={error:{}}).error.code||31e3,message:n.error.message||"Could not send DTMF: Signaling channel is disconnected",connection:this})},m.prototype.status=function(){return this._status},m.prototype.mute=function(e){if(void 0===e)e=!0,this.log.deprecated(".mute() is deprecated. Please use .mute(true) or .mute(false) to mute or unmute a call instead.");else if("function"==typeof e)return void this.addListener("mute",e);if(this.isMuted()!==e){this.mediaStream.mute(e);var t=this.isMuted();this._publisher.info("connection",t?"muted":"unmuted",null,this),this.emit("mute",t,this)}},m.prototype.isMuted=function(){return this.mediaStream.isMuted},m.prototype.unmute=function(){this.log.deprecated(".unmute() is deprecated. Please use .mute(false) to unmute a call instead."),this.mute(!1)},m.prototype.accept=function(e){if("function"!=typeof e){if("pending"===this._status){var t=e||this.options.audioConstraints,n=this;this._status="connecting";var i="function"==typeof this.options.getInputStream&&this.options.getInputStream();(i?this.mediaStream.setInputTracksFromStream(i):this.mediaStream.openWithConstraints(t)).then(function(){n._publisher.info("get-user-media","succeeded",{data:{audioConstraints:t}},n),function(){if("connecting"!==n._status)return v(n),void n.mediaStream.close();var e=[];for(var t in n.message)e.push(encodeURIComponent(t)+"="+encodeURIComponent(n.message[t]));var i="function"==typeof n.options.getSinkIds&&n.options.getSinkIds();Array.isArray(i)&&n.mediaStream._setSinkIds(i).catch(function(){});var r=e.join("&");"INCOMING"===n._direction?(n._isAnswered=!0,n.mediaStream.answerIncomingCall(n.parameters.CallSid,n.options.offerSdp,n.options.rtcConstraints,n.options.iceServers,function(e){n._publisher.info("connection","accepted-by-local",null,n),n._monitor.enable(e)})):(n.pstream.once("answer",n._onAnswer.bind(n)),n.mediaStream.makeOutgoingCall(n.pstream.token,r,n.outboundConnectionId,n.options.rtcConstraints,n.options.iceServers,function(e){n._publisher.info("connection","accepted-by-remote",null,n),n._monitor.enable(e)})),n._onHangup=function(e){if(e.callsid&&(n.parameters.CallSid||n.outboundConnectionId)){if(e.callsid!==n.parameters.CallSid&&e.callsid!==n.outboundConnectionId)return}else if(e.callsid)return;if(n.log("Received HANGUP from gateway"),e.error){var t={code:e.error.code||31e3,message:e.error.message||"Error sent from gateway in HANGUP",connection:n};n.log("Received an error from the gateway:",t),n.emit("error",t)}n.sendHangup=!1,n._publisher.info("connection","disconnected-by-remote",null,n),n._disconnect(null,!0),v(n)},n.pstream.addListener("hangup",n._onHangup)}()},function(e){var i,r;return e.code&&e.code===e.PERMISSION_DENIED||e.name&&"PermissionDeniedError"===e.name?(r=31208,i="User denied access to microphone, or the web browser did not allow microphone access at this address.",n._publisher.error("get-user-media","denied",{data:{audioConstraints:t,error:e}},n)):(r=31201,i="Error occurred while accessing microphone: "+e.name+(e.message?" ("+e.message+")":""),n._publisher.error("get-user-media","failed",{data:{audioConstraints:t,error:e}},n)),n._die(i,r)})}}else this.addListener("accept",e)},m.prototype.reject=function(e){"function"!=typeof e?"pending"===this._status&&(this.pstream.publish("reject",{callsid:this.parameters.CallSid}),this.emit("reject"),this.mediaStream.reject(this.parameters.CallSid),this._publisher.info("connection","rejected-by-local",null,this)):this.addListener("reject",e)},m.prototype.ignore=function(e){"function"!=typeof e?"pending"===this._status&&(this._status="closed",this.emit("cancel"),this.mediaStream.ignore(this.parameters.CallSid),this._publisher.info("connection","ignored-by-local",null,this)):this.addListener("cancel",e)},m.prototype.cancel=function(e){this.log.deprecated(".cancel() is deprecated. Please use .ignore() instead."),this.ignore(e)},m.prototype.disconnect=function(e){"function"!=typeof e?this._disconnect():this.addListener("disconnect",e)},m.prototype._disconnect=function(e,t){if(e="string"==typeof e?e:null,"open"===this._status||"connecting"===this._status||"ringing"===this._status){if(this.log("Disconnecting..."),null!==this.pstream&&"disconnected"!==this.pstream.status&&this.sendHangup){var n=this.parameters.CallSid||this.outboundConnectionId;if(n){var i={callsid:n};e&&(i.message=e),this.pstream.publish("hangup",i)}}v(this),this.mediaStream.close(),t||this._publisher.info("connection","disconnected-by-local",null,this)}},m.prototype.error=function(e){"function"!=typeof e||this.addListener("error",e)},m.prototype._die=function(e,t){this._disconnect(),this.emit("error",{message:e,code:t})},m.prototype._setCallSid=function(e){var t=e.callsid;t&&(this.parameters.CallSid=t,this.mediaStream.callSid=t)},m.prototype._setSinkIds=function(e){return this.mediaStream._setSinkIds(e)},m.prototype._setInputTracksFromStream=function(e){return this.mediaStream.setInputTracksFromStream(e)},m.prototype._onRinging=function(e){if(this._setCallSid(e),"connecting"===this._status||"ringing"===this._status){var t=!!e.sdp;this.options.enableRingingState?(this._status="ringing",this._publisher.info("connection","outgoing-ringing",{hasEarlyMedia:t},this),this.emit("ringing",t)):t&&this._onAnswer(e)}},m.prototype._onAnswer=function(e){this._isAnswered||(this._setCallSid(e),this._isAnswered=!0,this._maybeTransitionToOpen())},m.prototype._maybeTransitionToOpen=function(){this.mediaStream&&"open"===this.mediaStream.status&&this._isAnswered&&(this._status="open",this.emit("accept",this))},m.prototype.volume=function(e){window&&(window.AudioContext||window.webkitAudioContext)?"function"==typeof e&&this.on("volume",e):console.warn("This browser does not support Connection.volume")},m.prototype.getLocalStream=function(){return this.mediaStream&&this.mediaStream.stream},m.prototype.getRemoteStream=function(){return this.mediaStream&&this.mediaStream._remoteStream},m.prototype.postFeedback=function(e,t){if(void 0===e||null===e)return this._postFeedbackDeclined();if(-1===d.indexOf(e))throw new Error("Feedback score must be one of: "+d);if(void 0!==t&&null!==t&&-1===p.indexOf(t))throw new Error("Feedback issue must be one of: "+p);return this._publisher.post("info","feedback","received",{quality_score:e,issue_name:t},this,!0)},m.prototype._postFeedbackDeclined=function(){return this._publisher.post("info","feedback","received-none",null,this,!0)},m.prototype._getTempCallSid=function(){return this.outboundConnectionId},m.prototype._getRealCallSid=function(){return/^TJ/.test(this.parameters.CallSid)?null:this.parameters.CallSid},n.Connection=m},{"./constants":6,"./log":9,"./rtc":14,"./rtc/monitor":16,"./util":26,events:39,util:50}],6:[function(e,t,n){var i=e("../../package.json");t.exports.SOUNDS_BASE_URL="https://media.twiliocdn.com/sdk/js/client/sounds/releases/1.0.0",t.exports.RELEASE_VERSION=i.version},{"../../package.json":51}],7:[function(e,t,n){var i=e("./audiohelper"),r=e("events").EventEmitter,o=e("util"),s=e("./log"),a=e("./util"),c=e("./rtc"),u=e("./eventpublisher"),l=e("./sound"),d=e("./connection").Connection,p=e("./rtc/getusermedia"),f=e("./pstream").PStream,h=e("./constants");function m(e,t){if(!m.isSupported)throw new a.Exception("twilio.js 1.3+ SDKs require WebRTC/ORTC browser support. For more information, see <https://www.twilio.com/docs/api/client/twilio-js>. If you have any questions about this announcement, please contact Twilio Support at <help@twilio.com>.");if(!(this instanceof m))return new m(e,t);if(!e)throw new a.Exception("Capability token is not valid or missing.");t=t||{};var n={};for(var r in t)n[r]=t[r];var o={logPrefix:"[Device]",eventgw:"eventgw.twilio.com",Sound:t.soundFactory||l,connectionFactory:d,pStreamFactory:f,noRegister:!1,closeProtection:!1,secureSignaling:!0,warnings:!0,audioConstraints:!0,iceServers:[],region:"gll",dscp:!0,sounds:{}};for(var v in t=t||{},o)v in t||(t[v]=o[v]);t.rtcConstraints=t.dscp?{optional:[{googDscp:!0}]}:{},this.options=t,this.token=e,this._status="offline",this._region="offline",this._connectionSinkIds=["default"],this._connectionInputStream=null,this.connections=[],this._activeConnection=null,s.mixinLog(this,this.options.logPrefix),this.log.enabled=this.options.debug;var g=this._enabledSounds={incoming:!0,outgoing:!0,disconnect:!0},y=!1;function _(e,t){return y||(s.deprecated("Device.sounds is deprecated and will be removed in the next breaking release. Please use the new functionality available on Device.audio."),y=!0),void 0!==t&&(g[e]=t),g[e]}this.sounds={disconnect:_.bind(null,"disconnect"),incoming:_.bind(null,"incoming"),outgoing:_.bind(null,"outgoing")};var b={gll:"chunderw-vpc-gll.twilio.com",au1:"chunderw-vpc-gll-au1.twilio.com",br1:"chunderw-vpc-gll-br1.twilio.com",de1:"chunderw-vpc-gll-de1.twilio.com",ie1:"chunderw-vpc-gll-ie1.twilio.com",jp1:"chunderw-vpc-gll-jp1.twilio.com",sg1:"chunderw-vpc-gll-sg1.twilio.com",us1:"chunderw-vpc-gll-us1.twilio.com","us1-tnx":"chunderw-vpc-gll-us1-tnx.twilio.com","us2-tnx":"chunderw-vpc-gll-us2-tnx.twilio.com","ie1-tnx":"chunderw-vpc-gll-ie1-tnx.twilio.com","us1-ix":"chunderw-vpc-gll-us1-ix.twilio.com","us2-ix":"chunderw-vpc-gll-us2-ix.twilio.com","ie1-ix":"chunderw-vpc-gll-ie1-ix.twilio.com"},w={au:"au1",br:"br1",ie:"ie1",jp:"jp1",sg:"sg1","us-va":"us1","us-or":"us1"},S=t.region.toLowerCase();if(S in w&&(this.log.deprecated("Region "+S+" is deprecated, please use "+w[S]+"."),S=w[S]),!(S in b))throw new a.Exception("Region "+t.region+" is invalid. Valid values are: "+Object.keys(b).join(", "));t.chunderw="wss://"+(t.chunderw||b[S||"gll"])+"/signal",this.soundcache=new Map;var k,E,C="undefined"!=typeof document?document.createElement("audio"):{};try{k=C.canPlayType&&!!C.canPlayType("audio/mpeg").replace(/no/,"")}catch(e){k=!1}try{E=C.canPlayType&&!!C.canPlayType("audio/ogg;codecs='vorbis'").replace(/no/,"")}catch(e){E=!1}var T="mp3";E&&!k&&(T="ogg");var x={incoming:{filename:"incoming",shouldLoop:!0},outgoing:{filename:"outgoing",maxDuration:3e3},disconnect:{filename:"disconnect",maxDuration:3e3},dtmf1:{filename:"dtmf-1",maxDuration:1e3},dtmf2:{filename:"dtmf-2",maxDuration:1e3},dtmf3:{filename:"dtmf-3",maxDuration:1e3},dtmf4:{filename:"dtmf-4",maxDuration:1e3},dtmf5:{filename:"dtmf-5",maxDuration:1e3},dtmf6:{filename:"dtmf-6",maxDuration:1e3},dtmf7:{filename:"dtmf-7",maxDuration:1e3},dtmf8:{filename:"dtmf-8",maxDuration:1e3},dtmf9:{filename:"dtmf-9",maxDuration:1e3},dtmf0:{filename:"dtmf-0",maxDuration:1e3},dtmfs:{filename:"dtmf-star",maxDuration:1e3},dtmfh:{filename:"dtmf-hash",maxDuration:1e3}};for(var P in x){var D=x[P],I=new this.options.Sound(P,t.sounds[P]||h.SOUNDS_BASE_URL+"/"+D.filename+"."+T+"?cache=1_4_23",{maxDuration:D.maxDuration,minDuration:D.minDuration,shouldLoop:D.shouldLoop,audioContext:this.options.disableAudioContextSounds?null:m.audioContext});this.soundcache.set(P,I)}var R=this,L=this._publisher=new u("twilio-js-sdk",this.token,{host:this.options.eventgw,defaultPayload:function(e){var t={platform:c.getMediaEngine(),sdk_version:h.RELEASE_VERSION,selected_region:R.options.region};function n(e,n){n&&(t[e]=n)}e&&(n("call_sid",e._getRealCallSid()),n("temp_call_sid",e._getTempCallSid()),t.direction=e._direction);var i=R.stream;return i&&(n("gateway",i.gateway),n("region",i.region)),t}});!1===t.publishEvents&&L.disable(),(this.audio=new i(function(e,t){return("ringtone"===e?function(e){return Promise.resolve(R.soundcache.get("incoming").setSinkIds(e))}(t):function(e){e=e.forEach?e:[e],Array.from(R.soundcache.entries()).forEach(function(t){"incoming"!==t[0]&&t[1].setSinkIds(e)}),R._connectionSinkIds=e;var t=R._activeConnection;return t?t._setSinkIds(e):Promise.resolve()}(t)).then(function(){L.info("audio",e+"-devices-set",{audio_device_ids:t},R._activeConnection)},function(n){throw L.error("audio",e+"-devices-set-failed",{audio_device_ids:t,message:n.message},R._activeConnection),n})},function(e){var t=R._activeConnection;return t&&!e?Promise.reject(new Error("Cannot unset input device while a call is in progress.")):(R._connectionInputStream=e,t?t._setInputTracksFromStream(e):Promise.resolve())},p,{audioContext:m.audioContext,logEnabled:!!this.options.debug,logWarnings:!!this.options.warnings,enabledSounds:g})).on("deviceChange",function(e){var t=R._activeConnection,n=e.map(function(e){return e.deviceId});L.info("audio","device-change",{lost_active_device_ids:n},t),t&&t.mediaStream._onInputDevicesChanged()}),this.mediaPresence={audio:!this.options.noRegister},this.register(this.token);var A=this.options.closeProtection;function O(e){if(R._activeConnection){var t=!0===A?"A call is currently in-progress. Leaving or reloading this page will end the call.":A;return(e||window.event).returnValue=t,t}}function j(){R.disconnectAll()}return A&&"undefined"!=typeof window&&(window.addEventListener?window.addEventListener("beforeunload",O):window.attachEvent&&window.attachEvent("onbeforeunload",O)),"undefined"!=typeof window&&(window.addEventListener?window.addEventListener("unload",j):window.attachEvent&&window.attachEvent("onunload",j)),this.on("error",function(){}),this}function v(e,t,n){var i={getSinkIds:function(){return e._connectionSinkIds},getInputStream:function(){return e._connectionInputStream},debug:e.options.debug,warnings:e.options.warnings,publisher:e._publisher,enableRingingState:e.options.enableRingingState};for(var r in n=n||{},i)r in n||(n[r]=i[r]);var o=e.options.connectionFactory(e,t,p,n);return o.once("accept",function(){e._activeConnection=o,e._removeConnection(o),e.audio._maybeStartPollingVolume(),e.emit("connect",o)}),o.addListener("error",function(t){"closed"===o.status()&&e._removeConnection(o),e.audio._maybeStopPollingVolume(),e.emit("error",t)}),o.once("cancel",function(){e.log("Canceled: "+o.parameters.CallSid),e._removeConnection(o),e.audio._maybeStopPollingVolume(),e.emit("cancel",o)}),o.once("disconnect",function(){e.audio._maybeStopPollingVolume(),e._removeConnection(o),e._activeConnection===o&&(e._activeConnection=null),e.emit("disconnect",o)}),o.once("reject",function(){e.log("Rejected: "+o.parameters.CallSid),e.audio._maybeStopPollingVolume(),e._removeConnection(o)}),o}o.inherits(m,r),Object.defineProperties(m,{isSupported:{get:function(){return c.enabled()}}}),m.toString=function(){return"[Twilio.Device class]"},m.prototype.toString=function(){return"[Twilio.Device instance]"},m.prototype.register=function(e){this.stream?(this.stream.setToken(e),this._publisher.setToken(e)):this._setupStream(e)},m.prototype.registerPresence=function(){this.token&&(this.mediaPresence.audio=!0,this._sendPresence())},m.prototype.unregisterPresence=function(){this.mediaPresence.audio=!1,this._sendPresence()},m.prototype.connect=function(e,t){if("function"==typeof e)return this.addListener("connect",e);if(this._activeConnection)throw new Error("A Connection is already active");e=e||{},t=t||this.options.audioConstraints;var n=this._activeConnection=v(this,e);if(this.connections.splice(0).forEach(function(e){e.ignore()}),this.soundcache.get("incoming").stop(),this._enabledSounds.outgoing){var i=this;n.accept(function(){i.soundcache.get("outgoing").play()})}return n.accept(t),n},m.prototype.disconnectAll=function(){for(var e=[].concat(this.connections),t=0;t<e.length;t++)e[t].disconnect();this._activeConnection&&this._activeConnection.disconnect(),this.connections.length>0&&this.log("Connections left pending: "+this.connections.length)},m.prototype.destroy=function(){this._stopRegistrationTimer(),this.audio._unbind(),this.stream&&(this.stream.destroy(),this.stream=null)},m.prototype.disconnect=function(e){this.addListener("disconnect",e)},m.prototype.incoming=function(e){this.addListener("incoming",e)},m.prototype.offline=function(e){this.addListener("offline",e)},m.prototype.ready=function(e){this.addListener("ready",e)},m.prototype.error=function(e){this.addListener("error",e)},m.prototype.status=function(){return this._activeConnection?"busy":this._status},m.prototype.activeConnection=function(){return this._activeConnection||this.connections[0]},m.prototype.region=function(){return this._region},m.prototype._sendPresence=function(){this.stream&&(this.stream.register(this.mediaPresence),this.mediaPresence.audio?this._startRegistrationTimer():this._stopRegistrationTimer())},m.prototype._startRegistrationTimer=function(){clearTimeout(this.regTimer);var e=this;this.regTimer=setTimeout(function(){e._sendPresence()},3e4)},m.prototype._stopRegistrationTimer=function(){clearTimeout(this.regTimer)},m.prototype._setupStream=function(e){var t=this;this.log("Setting up PStream"),this.stream=this.options.pStreamFactory(e,this.options.chunderw,{debug:this.options.debug,secureSignaling:this.options.secureSignaling}),this.stream.addListener("connected",function(e){t._region={US_EAST_VIRGINIA:"us1",US_WEST_OREGON:"us2",ASIAPAC_SYDNEY:"au1",SOUTH_AMERICA_SAO_PAULO:"br1",EU_IRELAND:"ie1",ASIAPAC_TOKYO:"jp1",ASIAPAC_SINGAPORE:"sg1"}[e.region]||e.region,t._sendPresence()}),this.stream.addListener("close",function(){t.stream=null}),this.stream.addListener("ready",function(){t.log("Stream is ready"),"offline"===t._status&&(t._status="ready"),t.emit("ready",t)}),this.stream.addListener("offline",function(){t.log("Stream is offline"),t._status="offline",t._region="offline",t.emit("offline",t)}),this.stream.addListener("error",function(e){var n=e.error;n&&(e.callsid&&(n.connection=t._findConnection(e.callsid)),31205===n.code&&t._stopRegistrationTimer(),t.log("Received error: ",n),t.emit("error",n))}),this.stream.addListener("invite",function(e){if(t._activeConnection)t.log("Device busy; ignoring incoming invite");else if(e.callsid&&e.sdp){var n=e.parameters||{};n.CallSid=n.CallSid||e.callsid;var i=v(t,{},{offerSdp:e.sdp,callParameters:n});t.connections.push(i),i.once("accept",function(){t.soundcache.get("incoming").stop()}),["cancel","error","reject"].forEach(function(e){i.once(e,r)}),t._showIncomingConnection(i,t._enabledSounds.incoming?function(){return t.soundcache.get("incoming").play()}:function(){return Promise.resolve()})}else t.emit("error",{message:"Malformed invite from gateway"});function r(){t.connections.length||t.soundcache.get("incoming").stop()}})},m.prototype._showIncomingConnection=function(e,t){var n,i=this;return Promise.race([t(),new Promise(function(e,t){n=setTimeout(function(){t(new Error("Playing incoming ringtone took too long; it might not play. Continuing execution..."))},2e3)})]).catch(function(e){console.warn(e.message)}).then(function(){clearTimeout(n),i.emit("incoming",e)})},m.prototype._removeConnection=function(e){for(var t=this.connections.length-1;t>=0;t--)e===this.connections[t]&&this.connections.splice(t,1)},m.prototype._findConnection=function(e){for(var t=0;t<this.connections.length;t++){var n=this.connections[t];if(n.parameters.CallSid===e||n.outboundConnectionId===e)return n}return null},n.Device=function(e){var t=[],n=[];function i(t){e.instance?t():n.push(t)}function r(t){var n=(t.code?t.code+": ":"")+t.message;if(e.instance){for(var i=0,o=e.instance.listeners("error"),s=0;s<o.length;s++)o[s]!==r&&i++;if(i>1)return;e.instance.log(n)}throw new a.Exception(n)}var o={instance:null,setup:function(i,o){var s;if(e.audioContext||("undefined"!=typeof AudioContext?e.audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext&&(e.audioContext=new webkitAudioContext)),e.instance)e.instance.log("Found existing Device; using new token but ignoring options"),e.instance.token=i,e.instance.register(i);else{for(e.instance=new m(i,o),e.error(r),e.sounds=e.instance.sounds,s=0;s<n.length;s++)n[s]();n=[]}for(s=0;s<t.length;s++)t[s](i,o);return t=[],e},connect:function(t,n){if("function"==typeof t)return i(function(){e.instance.addListener("connect",t)}),null;if(!e.instance)throw new a.Exception("Run Twilio.Device.setup()");return e.instance.connections.length>0?(e.instance.emit("error",{message:"A connection is currently active"}),null):e.instance.connect(t,n)},disconnectAll:function(){return i(function(){e.instance.disconnectAll()}),e},disconnect:function(t){return i(function(){e.instance.addListener("disconnect",t)}),e},status:function(){if(!e.instance)throw new a.Exception("Run Twilio.Device.setup()");return e.instance.status()},region:function(){if(!e.instance)throw new a.Exception("Run Twilio.Device.setup()");return e.instance.region()},ready:function(t){return i(function(){e.instance.addListener("ready",t)}),e},error:function(t){return i(function(){t!==r&&e.instance.removeListener("error",r),e.instance.addListener("error",t)}),e},offline:function(t){return i(function(){e.instance.addListener("offline",t)}),e},incoming:function(t){return i(function(){e.instance.addListener("incoming",t)}),e},destroy:function(){return e.instance&&e.instance.destroy(),e},cancel:function(t){return i(function(){e.instance.addListener("cancel",t)}),e},activeConnection:function(){return e.instance?e.instance.activeConnection():null}};for(var s in o)e[s]=o[s];return Object.defineProperties(e,{audio:{get:function(){return e.instance.audio}}}),e}(m)},{"./audiohelper":4,"./connection":5,"./constants":6,"./eventpublisher":8,"./log":9,"./pstream":11,"./rtc":14,"./rtc/getusermedia":13,"./sound":24,"./util":26,events:39,util:50}],8:[function(e,t,n){var i=e("./request");function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);var o=(n=Object.assign({defaultPayload:function(){return{}},host:"eventgw.twilio.com"},n)).defaultPayload;"function"!=typeof o&&(o=function(){return Object.assign({},n.defaultPayload)});var s=!0;Object.defineProperties(this,{_defaultPayload:{value:o},_isEnabled:{get:function(){return s},set:function(e){s=e}},_host:{value:n.host},_request:{value:n.request||i},_token:{value:t,writable:!0},isEnabled:{enumerable:!0,get:function(){return s}},productName:{enumerable:!0,value:e},token:{enumerable:!0,get:function(){return this._token}}})}function o(e){return{timestamp:new Date(e.timestamp).toISOString(),total_packets_received:e.totals.packetsReceived,total_packets_lost:e.totals.packetsLost,total_packets_sent:e.totals.packetsSent,total_bytes_received:e.totals.bytesReceived,total_bytes_sent:e.totals.bytesSent,packets_received:e.packetsReceived,packets_lost:e.packetsLost,packets_lost_fraction:e.packetsLostFraction&&Math.round(100*e.packetsLostFraction)/100,audio_level_in:e.audioInputLevel,audio_level_out:e.audioOutputLevel,call_volume_input:e.inputVolume,call_volume_output:e.outputVolume,jitter:e.jitter,rtt:e.rtt,mos:e.mos&&Math.round(100*e.mos)/100}}r.prototype._post=function(e,t,n,i,r,o,s){if(!this.isEnabled&&!s)return Promise.resolve();var a={publisher:this.productName,group:n,name:i,timestamp:(new Date).toISOString(),level:t.toUpperCase(),payload_type:"application/json",private:!1,payload:r&&r.forEach?r.slice(0):Object.assign(this._defaultPayload(o),r)},c={url:"https://"+this._host+"/v2/"+e,body:a,headers:{"Content-Type":"application/json","X-Twilio-Token":this.token}},u=this;return new Promise(function(e,t){u._request.post(c,function(n){n?t(n):e()})})},r.prototype.post=function(e,t,n,i,r,o){return this._post("EndpointEvents",e,t,n,i,r,o)},r.prototype.debug=function(e,t,n,i){return this.post("debug",e,t,n,i)},r.prototype.info=function(e,t,n,i){return this.post("info",e,t,n,i)},r.prototype.warn=function(e,t,n,i){return this.post("warning",e,t,n,i)},r.prototype.error=function(e,t,n,i){return this.post("error",e,t,n,i)},r.prototype.postMetrics=function(e,t,n,i){var r=this;return new Promise(function(s){var a=n.map(o).map(function(e){return Object.assign(e,i)});s(r._post("EndpointMetrics","info",e,t,a))})},r.prototype.setToken=function(e){this._token=e},r.prototype.enable=function(){this._isEnabled=!0},r.prototype.disable=function(){this._isEnabled=!1},t.exports=r},{"./request":12}],9:[function(e,t,n){n.mixinLog=function(e,t){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(n.enabled)for(var i=n.prefix?n.prefix+" ":"",r=0;r<e.length;r++){var o=e[r];n.handler("string"==typeof o?i+o:o)}}function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(n.warnings)for(var i=0;i<e.length;i++)n.warnHandler(e[i])}n.enabled=!0,n.prefix=t||"",n.handler=n.defaultHandler=function(e){"undefined"!=typeof console&&console.log(e)},n.warnings=!0,n.warnHandler=n.defaultWarnHandler=function(e){"undefined"!=typeof console&&("function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))},n.deprecated=i,n.warn=i,e.log=n}},{}],10:[function(e,t,n){var i=e("./constants").SOUNDS_BASE_URL+"/outgoing.mp3";function r(e,t,n,i){Object.defineProperties(this,{_activeDevices:{value:new Set},_availableDevices:{value:t},_beforeChange:{value:n},_isSupported:{value:i},_name:{value:e}})}r.prototype._delete=function(e){var t=this._activeDevices.delete(e),n=this._availableDevices.get("default")||Array.from(this._availableDevices.values())[0];!this._activeDevices.size&&n&&this._activeDevices.add(n);var i=Array.from(this._activeDevices.values()).map(function(e){return e.deviceId});return this._beforeChange(this._name,i),t},r.prototype.get=function(){return this._activeDevices},r.prototype.set=function(e){if(!this._isSupported)return Promise.reject(new Error("This browser does not support audio output selection"));if(!(e=Array.isArray(e)?e:[e]).length)return Promise.reject(new Error("Must specify at least one device to set"));var t=[],n=e.map(function(e){var n=this._availableDevices.get(e);return n||t.push(e),n},this);if(t.length)return Promise.reject(new Error("Devices not found: "+t.join(", ")));var i=this;return new Promise(function(t){t(i._beforeChange(i._name,e))}).then(function(){i._activeDevices.clear(),n.forEach(i._activeDevices.add,i._activeDevices)})},r.prototype.test=function(e){return this._isSupported?(e=e||i,this._activeDevices.size?Promise.all(Array.from(this._activeDevices).map(function(t){var n=new Audio([e]);return n.setSinkId(t.deviceId).then(function(){return n.play()})})):Promise.reject(new Error("No active output devices to test"))):Promise.reject(new Error("This browser does not support audio output selection"))},t.exports=r},{"./constants":6}],11:[function(e,t,n){var i=e("./constants"),r=e("events").EventEmitter,o=e("util"),s=e("./log"),a=e("./wstransport").default;function c(e,t,n){if(!(this instanceof c))return new c(e,t,n);var i={logPrefix:"[PStream]",secureSignaling:!0,TransportFactory:a,debug:!1};for(var r in n=n||{},i)r in n||(n[r]=i[r]);this.options=n,this.token=e||"",this.status="disconnected",this.uri=t,this.gateway=null,this.region=null,this._messageQueue=[],this._handleTransportClose=this._handleTransportClose.bind(this),this._handleTransportError=this._handleTransportError.bind(this),this._handleTransportMessage=this._handleTransportMessage.bind(this),this._handleTransportOpen=this._handleTransportOpen.bind(this),s.mixinLog(this,this.options.logPrefix),this.log.enabled=this.options.debug,this.on("error",function(){});var o=this;return this.addListener("ready",function(){o.status="ready"}),this.addListener("offline",function(){o.status="offline"}),this.addListener("close",function(){o.log('Received "close" from server. Destroying PStream...'),o._destroy()}),this.transport=new this.options.TransportFactory(this.uri,{logLevel:this.options.debug?"debug":"off"}),this.transport.on("close",this._handleTransportClose),this.transport.on("error",this._handleTransportError),this.transport.on("message",this._handleTransportMessage),this.transport.on("open",this._handleTransportOpen),this.transport.open(),this}o.inherits(c,r),c.prototype._handleTransportClose=function(){"disconnected"!==this.status&&("offline"!==this.status&&this.emit("offline",this),this.status="disconnected")},c.prototype._handleTransportError=function(e){this.emit("error",e)},c.prototype._handleTransportMessage=function(e){if(e&&e.data&&"string"==typeof e.data){var t=JSON.parse(e.data),n=t.type,i=t.payload,r=void 0===i?{}:i;this.gateway=r.gateway||this.gateway,this.region=r.region||this.region,this.emit(n,r)}},c.prototype._handleTransportOpen=function(){var e=this;this.status="connected",this.setToken(this.token),this._messageQueue.splice(0,this._messageQueue.length).forEach(function(t){return e._publish.apply(e,t)})},c.toString=function(){return"[Twilio.PStream class]"},c.prototype.toString=function(){return"[Twilio.PStream instance]"},c.prototype.setToken=function(e){this.log("Setting token and publishing listen"),this.token=e;var t,n={token:e,browserinfo:(t="undefined"!=typeof navigator?navigator:{},{p:"browser",v:i.RELEASE_VERSION,browser:{userAgent:t.userAgent||"unknown",platform:t.platform||"unknown"},plugin:"rtc"})};this._publish("listen",n)},c.prototype.register=function(e){this._publish("register",{media:e},!0)},c.prototype._destroy=function(){this.transport.removeListener("close",this._handleTransportClose),this.transport.removeListener("error",this._handleTransportError),this.transport.removeListener("message",this._handleTransportMessage),this.transport.removeListener("open",this._handleTransportOpen),this.transport.close(),this.emit("offline",this)},c.prototype.destroy=function(){return this.log("PStream.destroy() called..."),this._destroy(),this},c.prototype.publish=function(e,t){return this._publish(e,t,!0)},c.prototype._publish=function(e,t,n){var i=JSON.stringify({type:e,version:"1.4",payload:t});!this.transport.send(i)&&n&&this._messageQueue.push([e,t,!0])},n.PStream=c},{"./constants":6,"./log":9,"./wstransport":27,events:39,util:50}],12:[function(e,t,n){var i=e("xmlhttprequest").XMLHttpRequest,r=function(e,t,n){var r={};r.XMLHttpRequest=r.XMLHttpRequest||i;var o=new r.XMLHttpRequest;for(var s in o.open(e,t.url,!0),o.onreadystatechange=function(){4===o.readyState&&(200<=o.status&&o.status<300?n(null,o.responseText):n(new Error(o.responseText)))},t.headers)o.setRequestHeader(s,t.headers[s]);o.send(JSON.stringify(t.body))};r.get=function(e,t){return new this("GET",e,t)},r.post=function(e,t){return new this("POST",e,t)},t.exports=r},{xmlhttprequest:2}],13:[function(e,t,n){var i=e("../util");t.exports=function(e,t){return(t=t||{}).util=t.util||i,t.navigator=t.navigator||("undefined"!=typeof navigator?navigator:null),new Promise(function(n,i){if(!t.navigator)throw new Error("getUserMedia is not supported");switch("function"){case typeof(t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia):return n(t.navigator.mediaDevices.getUserMedia(e));case typeof t.navigator.webkitGetUserMedia:return t.navigator.webkitGetUserMedia(e,n,i);case typeof t.navigator.mozGetUserMedia:return t.navigator.mozGetUserMedia(e,n,i);case typeof t.navigator.getUserMedia:return t.navigator.getUserMedia(e,n,i);default:throw new Error("getUserMedia is not supported")}}).catch(function(e){throw t.util.isFirefox()&&"NotReadableError"===e.name?new Error("Firefox does not currently support opening multiple audio input trackssimultaneously, even across different tabs.\nRelated Bugzilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324"):e})}},{"../util":26}],14:[function(e,t,n){var i=e("./peerconnection");t.exports={enabled:function(e){return void 0!==e&&(i.enabled=e),i.enabled},getMediaEngine:function(){return"undefined"!=typeof RTCIceGatherer?"ORTC":"WebRTC"},PeerConnection:i}},{"./peerconnection":18}],15:[function(e,t,n){var i="undefined"!=typeof window?window.RTCStatsReport:void 0;function r(e){if(!(this instanceof r))return new r(e);var t=this;Object.defineProperties(this,{size:{enumerable:!0,get:function(){return t._map.size}},_map:{value:e}}),this[Symbol.iterator]=e[Symbol.iterator]}function o(e){return{type:"transport",id:e.id,timestamp:Date.parse(e.timestamp),bytesSent:void 0,bytesReceived:void 0,rtcpTransportStatsId:void 0,dtlsState:void 0,selectedCandidatePairId:e.stat("selectedCandidatePairId"),localCertificateId:e.stat("localCertificateId"),remoteCertificateId:e.stat("remoteCertificateId")}}function s(e,t){return{id:e.id,timestamp:Date.parse(e.timestamp),ssrc:e.stat("ssrc"),associateStatsId:void 0,isRemote:void 0,mediaType:e.stat("mediaType"),trackId:"track-"+e.id,transportId:e.stat("transportId"),codecId:"codec-"+e.id,firCount:t?u(e,"googFirsSent"):void 0,pliCount:u(e,t?"googPlisSent":"googPlisReceived"),nackCount:u(e,t?"googNacksSent":"googNacksReceived"),sliCount:void 0,qpSum:u(e,"qpSum")}}function a(e,t){return{type:t?"remote-candidate":"local-candidate",id:e.id,timestamp:Date.parse(e.timestamp),transportId:void 0,isRemote:t,ip:e.stat("ipAddress"),port:u(e,"portNumber"),protocol:e.stat("transport"),candidateType:function(e){switch(e){case"peerreflexive":return"prflx";case"serverreflexive":return"srflx";case"host":case"relay":default:return e}}(e.stat("candidateType")),priority:l(e,"priority"),url:void 0,relayProtocol:void 0,deleted:void 0}}function c(e){return isNaN(e)||""===e?void 0:parseInt(e,10)/1e3}function u(e,t){var n=e.stat(t);return p(e,t)?parseInt(n,10):void 0}function l(e,t){var n=e.stat(t);return p(e,t)?parseFloat(n):void 0}function d(e,t){var n=e.stat(t);return p(e,t)?"true"===n||!0===n:void 0}function p(e,t){var n=e.stat(t);return void 0!==n&&""!==n}i&&((r.prototype=Object.create(i.prototype)).constructor=r),["entries","forEach","get","has","keys","values"].forEach(function(e){r.prototype[e]=function(){for(var t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return(t=this._map)[e].apply(t,n)}}),r.fromArray=function(e){return new r(e.reduce(function(e,t){return e.set(t.id,t),e},new Map))},r.fromRTCStatsResponse=function(e){var t,n=new Map,i=e.result().reduce(function(e,i){var r=i.id;switch(i.type){case"googCertificate":e.set(r,function(e){return{type:"certificate",id:e.id,timestamp:Date.parse(e.timestamp),fingerprint:e.stat("googFingerprint"),fingerprintAlgorithm:e.stat("googFingerprintAlgorithm"),base64Certificate:e.stat("googDerBase64"),issuerCertificateId:e.stat("googIssuerId")}}(i));break;case"datachannel":e.set(r,function(e){return{type:"data-channel",id:e.id,timestamp:Date.parse(e.timestamp),label:e.stat("label"),protocol:e.stat("protocol"),datachannelid:e.stat("datachannelid"),transportId:e.stat("transportId"),state:e.stat("state"),messagesSent:void 0,bytesSent:void 0,messagesReceived:void 0,bytesReceived:void 0}}(i));break;case"googCandidatePair":d(i,"googActiveConnection")&&(t=r),e.set(r,function(e){return{type:"candidate-pair",id:e.id,timestamp:Date.parse(e.timestamp),transportId:e.stat("googChannelId"),localCandidateId:e.stat("localCandidateId"),remoteCandidateId:e.stat("remoteCandidateId"),state:void 0,priority:void 0,nominated:void 0,writable:d(e,"googWritable"),readable:void 0,bytesSent:u(e,"bytesSent"),bytesReceived:u(e,"bytesReceived"),lastPacketSentTimestamp:void 0,lastPacketReceivedTimestamp:void 0,totalRoundTripTime:void 0,currentRoundTripTime:c(e.stat("googRtt")),availableOutgoingBitrate:void 0,availableIncomingBitrate:void 0,requestsReceived:u(e,"requestsReceived"),requestsSent:u(e,"requestsSent"),responsesReceived:u(e,"responsesReceived"),responsesSent:u(e,"responsesSent"),retransmissionsReceived:void 0,retransmissionsSent:void 0,consentRequestsSent:u(e,"consentRequestsSent")}}(i));break;case"localcandidate":e.set(r,a(i,!1));break;case"remotecandidate":e.set(r,a(i,!0));break;case"ssrc":p(i,"packetsReceived")?e.set("rtp-"+r,function(e){var t=s(e,!0);return Object.assign(t,{type:"inbound-rtp",packetsReceived:u(e,"packetsReceived"),bytesReceived:u(e,"bytesReceived"),packetsLost:u(e,"packetsLost"),jitter:c(e.stat("googJitterReceived")),fractionLost:void 0,roundTripTime:c(e.stat("googRtt")),packetsDiscarded:void 0,packetsRepaired:void 0,burstPacketsLost:void 0,burstPacketsDiscarded:void 0,burstLossCount:void 0,burstDiscardCount:void 0,burstLossRate:void 0,burstDiscardRate:void 0,gapLossRate:void 0,gapDiscardRate:void 0,framesDecoded:u(e,"framesDecoded")}),t}(i)):e.set("rtp-"+r,function(e){var t=s(e,!1);return Object.assign(t,{type:"outbound-rtp",remoteTimestamp:void 0,packetsSent:u(e,"packetsSent"),bytesSent:u(e,"bytesSent"),targetBitrate:void 0,framesEncoded:u(e,"framesEncoded")}),t}(i)),e.set("track-"+r,function(e){return{type:"track",id:e.id,timestamp:Date.parse(e.timestamp),trackIdentifier:e.stat("googTrackId"),remoteSource:void 0,ended:void 0,kind:e.stat("mediaType"),detached:void 0,ssrcIds:void 0,frameWidth:p(e,"googFrameWidthReceived")?u(e,"googFrameWidthReceived"):u(e,"googFrameWidthSent"),frameHeight:p(e,"googFrameHeightReceived")?u(e,"googFrameHeightReceived"):u(e,"googFrameHeightSent"),framesPerSecond:void 0,framesSent:u(e,"framesEncoded"),framesReceived:void 0,framesDecoded:u(e,"framesDecoded"),framesDropped:void 0,framesCorrupted:void 0,partialFramesLost:void 0,fullFramesLost:void 0,audioLevel:p(e,"audioOutputLevel")?u(e,"audioOutputLevel")/32767:(u(e,"audioInputLevel")||0)/32767,echoReturnLoss:l(e,"googEchoCancellationReturnLoss"),echoReturnLossEnhancement:l(e,"googEchoCancellationReturnLossEnhancement")}}(i)),e.set("codec-"+r,function(e){return{type:"codec",id:e.id,timestamp:Date.parse(e.timestamp),payloadType:void 0,mimeType:e.stat("mediaType")+"/"+e.stat("googCodecName"),clockRate:void 0,channels:void 0,sdpFmtpLine:void 0,implementation:void 0}}(i));break;case"googComponent":var f=o(i);n.set(f.selectedCandidatePairId,r),e.set(r,o(i))}return e},new Map);if(t){var f=n.get(t);f&&(i.get(f).dtlsState="connected")}return new r(i)},t.exports=r},{}],16:[function(e,t,n){var i=e("events").EventEmitter,r=e("./stats"),o=e("util").inherits,s=e("./mos"),a={audioInputLevel:{maxDuration:10},audioOutputLevel:{maxDuration:10},packetsLostFraction:{max:1},jitter:{max:30},rtt:{max:400},mos:{min:3}};function c(e){if(!(this instanceof c))return new c(e);e=e||{};var t=Object.assign({},a,e.thresholds);Object.defineProperties(this,{_activeWarnings:{value:new Map},_currentStreaks:{value:new Map},_peerConnection:{value:e.peerConnection,writable:!0},_sampleBuffer:{value:[]},_sampleInterval:{value:null,writable:!0},_thresholds:{value:t},_warningsEnabled:{value:!0,writable:!0}}),e.peerConnection&&this.enable(),i.call(this)}o(c,i),c.createSample=function(e,t){var n=e.packetsReceived-(t&&t.totals.packetsReceived||0),i=e.packetsLost-(t&&t.totals.packetsLost||0),r=n+i,o=r>0?i/r*100:0,a=e.packetsReceived+e.packetsLost;return{timestamp:e.timestamp,totals:{packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,packetsSent:e.packetsSent,packetsLostFraction:a>0?e.packetsLost/a*100:100,bytesReceived:e.bytesReceived,bytesSent:e.bytesSent},packetsSent:e.packetsSent-(t&&t.totals.packetsSent||0),packetsReceived:n,packetsLost:i,packetsLostFraction:o,audioInputLevel:e.audioInputLevel,audioOutputLevel:e.audioOutputLevel,jitter:e.jitter,rtt:e.rtt,mos:s.calculate(e,t&&o)}},c.prototype.enable=function(e){if(e){if(this._peerConnection&&e!==this._peerConnection)throw new Error("Attempted to replace an existing PeerConnection in RTCMonitor.enable");this._peerConnection=e}if(!this._peerConnection)throw new Error("Can not enable RTCMonitor without a PeerConnection");return this._sampleInterval=this._sampleInterval||setInterval(this._fetchSample.bind(this),1e3),this},c.prototype.disable=function(){return clearInterval(this._sampleInterval),this._sampleInterval=null,this},c.prototype.getSample=function(){var e=this;return r(this._peerConnection).then(function(t){return c.createSample(t,e._sampleBuffer.length&&e._sampleBuffer[e._sampleBuffer.length-1])})},c.prototype._fetchSample=function(){var e=this;return this.getSample().then(function(t){return e._addSample(t),e._raiseWarnings(),e.emit("sample",t),t},function(t){e.disable(),e.emit("error",t)})},c.prototype._addSample=function(e){var t=this._sampleBuffer;t.push(e),t.length>5&&t.splice(0,t.length-5)},c.prototype._raiseWarnings=function(){if(this._warningsEnabled)for(var e in this._thresholds)this._raiseWarningsForStat(e)},c.prototype.enableWarnings=function(){return this._warningsEnabled=!0,this},c.prototype.disableWarnings=function(){return this._warningsEnabled&&this._activeWarnings.clear(),this._warningsEnabled=!1,this},c.prototype._raiseWarningsForStat=function(e){var t,n=this._sampleBuffer,i=this._thresholds[e],r=n.slice(-5),o=r.map(function(t){return t[e]});if(!o.some(function(e){return void 0===e||null===e})&&("number"==typeof i.max&&((t=function(e,t){return t.reduce(function(t,n){return t+(n>e?1:0)},0)}(i.max,o))>=3?this._raiseWarning(e,"max",{values:o}):t<=0&&this._clearWarning(e,"max",{values:o})),"number"==typeof i.min&&((t=function(e,t){return t.reduce(function(t,n){return t+(n<e?1:0)},0)}(i.min,o))>=3?this._raiseWarning(e,"min",{values:o}):t<=0&&this._clearWarning(e,"min",{values:o})),"number"==typeof i.maxDuration&&n.length>1)){var s=(r=n.slice(-2))[0][e],a=r[1][e],c=this._currentStreaks.get(e)||0,u=s===a?c+1:0;this._currentStreaks.set(e,u),u>=i.maxDuration?this._raiseWarning(e,"maxDuration",{value:u}):0===u&&this._clearWarning(e,"maxDuration",{value:c})}},c.prototype._clearWarning=function(e,t,n){var i=e+":"+t,r=this._activeWarnings.get(i);!r||Date.now()-r.timeRaised<5e3||(this._activeWarnings.delete(i),this.emit("warning-cleared",Object.assign({name:e,threshold:{name:t,value:this._thresholds[e][t]}},n)))},c.prototype._raiseWarning=function(e,t,n){var i=e+":"+t;this._activeWarnings.has(i)||(this._activeWarnings.set(i,{timeRaised:Date.now()}),this.emit("warning",Object.assign({name:e,threshold:{name:t,value:this._thresholds[e][t]}},n)))},t.exports=c},{"./mos":17,"./stats":20,events:39,util:50}],17:[function(e,t,n){function i(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)&&e>=0}t.exports={calculate:function(e,t){if(!(e&&i(e.rtt)&&i(e.jitter)&&i(t)))return null;var n=function(t,n,i){var r=e.rtt+2*e.jitter+10,o=0;switch(!0){case r<160:o=94.768-r/40;break;case r<1e3:o=94.768-(r-120)/10;break;case r>=1e3:o=94.768-r/100}var s=.01;switch(!0){case-1===i:s=0,o=0;break;case i<=o/2.5:s=2.5;break;case i>o/2.5&&i<100:s=.25}return o-i*s}(0,0,t),r=1+.035*n+7e-6*n*(n-60)*(100-n);return r>=1&&r<4.6?r:null}}},{}],18:[function(e,t,n){var i=e("../log"),r=e("../util"),o=e("./rtcpc"),s="new";function a(e,t,n){if(!e||!t)throw new Error("Device and getUserMedia are required arguments");if(!(this instanceof a))return new a(e,t,n);function o(){}this.onopen=o,this.onerror=o,this.onclose=o,this.ondisconnect=o,this.onreconnect=o,this.onsignalingstatechange=o,this.oniceconnectionstatechange=o,this.onicecandidate=o,this.onvolume=o,this.version=null,this.pstream=e.stream,this.stream=null,this.sinkIds=new Set(["default"]),this.outputs=new Map,this.status="connecting",this.callSid=null,this.isMuted=!1,this.getUserMedia=t;var c="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);return this._isSinkSupported=!!c&&"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId,this._audioContext=c&&e.audio._audioContext,this._masterAudio=null,this._masterAudioDeviceId=null,this._mediaStreamSource=null,this._dtmfSender=null,this._dtmfSenderUnsupported=!1,this._callEvents=[],this._nextTimeToPublish=Date.now(),this._onAnswerOrRinging=o,this._remoteStream=null,this._shouldManageStream=!0,i.mixinLog(this,"[Twilio.PeerConnection]"),this.log.enabled=e.options.debug,this.log.warnings=e.options.warnings,this._iceState=s,this.options=n=n||{},this.navigator=n.navigator||("undefined"!=typeof navigator?navigator:null),this.util=n.util||r,this}function c(e,t){"function"==typeof e.addTrack?t.getAudioTracks().forEach(function(n){e.addTrack(n,t)}):e.addStream(t)}function u(e,t){if(void 0!==e.srcObject)e.srcObject=t;else if(void 0!==e.mozSrcObject)e.mozSrcObject=t;else{if(void 0===e.src)return!1;var n=e.options.window||window;e.src=(n.URL||n.webkitURL).createObjectURL(t)}return!0}a.prototype.uri=function(){return this._uri},a.prototype.openWithConstraints=function(e){return this.getUserMedia({audio:e}).then(this._setInputTracksFromStream.bind(this,!1))},a.prototype.setInputTracksFromStream=function(e){var t=this;return this._setInputTracksFromStream(!0,e).then(function(){t._shouldManageStream=!1})},a.prototype._createAnalyser=function(e,t){var n=t.createAnalyser();return n.fftSize=32,n.smoothingTimeConstant=.3,t.createMediaStreamSource(e).connect(n),n},a.prototype._setVolumeHandler=function(e){this.onvolume=e},a.prototype._startPollingVolume=function(){if(this._audioContext&&this.stream&&this._remoteStream){var e=this._audioContext,t=this._inputAnalyser=this._createAnalyser(this.stream,e),n=new Uint8Array(t.frequencyBinCount),i=this._outputAnalyser=this._createAnalyser(this._remoteStream,e),r=new Uint8Array(i.frequencyBinCount),o=this;requestAnimationFrame(function e(){if(o._audioContext){if("closed"===o.status)return o._inputAnalyser.disconnect(),void o._outputAnalyser.disconnect();o._inputAnalyser.getByteFrequencyData(n);var t=o.util.average(n);o._outputAnalyser.getByteFrequencyData(r);var i=o.util.average(r);o.onvolume(t/255,i/255),requestAnimationFrame(e)}})}},a.prototype._stopStream=function(e){this._shouldManageStream&&("function"==typeof MediaStreamTrack.prototype.stop?("function"==typeof e.getAudioTracks?e.getAudioTracks():e.audioTracks).forEach(function(e){e.stop()}):e.stop())},a.prototype._setInputTracksFromStream=function(e,t){var n=this;if(!t)return Promise.reject(new Error("Can not set input stream to null while in a call"));if(!t.getAudioTracks().length)return Promise.reject(new Error("Supplied input stream has no audio tracks"));var i,r,o=this.stream;return o?(this._stopStream(o),r=o,"function"==typeof(i=this.version.pc).removeTrack?i.getSenders().forEach(function(e){i.removeTrack(e)}):i.removeStream(r),o.getAudioTracks().forEach(o.removeTrack,o),t.getAudioTracks().forEach(o.addTrack,o),c(this.version.pc,t)):this.stream=e?function(e){var t="undefined"!=typeof MediaStream?new MediaStream:new webkitMediaStream;return e.getAudioTracks().forEach(t.addTrack,t),t}(t):t,this.mute(this.isMuted),this.version?new Promise(function(e,t){n.version.createOffer({audio:!0},function(){n.version.processAnswer(n._answerSdp,function(){n._audioContext&&(n._inputAnalyser=n._createAnalyser(n.stream,n._audioContext)),e(n.stream)},t)},t)}):Promise.resolve(this.stream)},a.prototype._onInputDevicesChanged=function(){this.stream&&this.stream.getAudioTracks().every(function(e){return"ended"===e.readyState})&&this._shouldManageStream&&this.openWithConstraints(!0)},a.prototype._setSinkIds=function(e){return this._isSinkSupported?(this.sinkIds=new Set(e.forEach?e:[e]),this.version?this._updateAudioOutputs():Promise.resolve()):Promise.reject(new Error("Audio output selection is not supported by this browser"))},a.prototype._updateAudioOutputs=function(){var e=Array.from(this.sinkIds).filter(function(e){return!this.outputs.has(e)},this),t=Array.from(this.outputs.keys()).filter(function(e){return!this.sinkIds.has(e)},this),n=this,i=e.map(this._createAudioOutput,this);return Promise.all(i).then(function(){return Promise.all(t.map(n._removeAudioOutput,n))})},a.prototype._createAudio=function(e){return new Audio(e)},a.prototype._createAudioOutput=function(e){var t=this._audioContext.createMediaStreamDestination();this._mediaStreamSource.connect(t);var n=this._createAudio();u(n,t.stream);var i=this;return n.setSinkId(e).then(function(){return n.play()}).then(function(){i.outputs.set(e,{audio:n,dest:t})})},a.prototype._removeAudioOutputs=function(){return Array.from(this.outputs.keys()).map(this._removeAudioOutput,this)},a.prototype._disableOutput=function(e,t){var n=e.outputs.get(t);n&&(n.audio&&(n.audio.pause(),n.audio.src=""),n.dest&&n.dest.disconnect())},a.prototype._reassignMasterOutput=function(e,t){var n=e.outputs.get(t);e.outputs.delete(t);var i=this,r=Array.from(e.outputs.keys())[0]||"default";return n.audio.setSinkId(r).then(function(){i._disableOutput(e,r),e.outputs.set(r,n),e._masterAudioDeviceId=r}).catch(function(i){throw e.outputs.set(t,n),i})},a.prototype._removeAudioOutput=function(e){return this._masterAudioDeviceId===e?this._reassignMasterOutput(this,e):(this._disableOutput(this,e),this.outputs.delete(e),Promise.resolve())},a.prototype._onAddTrack=function(e,t){var n=e._masterAudio=this._createAudio();u(n,t),n.play();var i=Array.from(e.outputs.keys())[0]||"default";e._masterAudioDeviceId=i,e.outputs.set(i,{audio:n}),e._mediaStreamSource=e._audioContext.createMediaStreamSource(t),e.pcStream=t,e._updateAudioOutputs()},a.prototype._fallbackOnAddTrack=function(e,t){var n=document&&document.createElement("audio");n.autoplay=!0,u(n,t)||e.log("Error attaching stream to element."),e.outputs.set("default",{audio:n})},a.prototype._setupPeerConnection=function(e,t){var n=this,i=this._getProtocol();return i.create(this.log,e,t),c(i.pc,this.stream),i.pc["ontrack"in i.pc?"ontrack":"onaddstream"]=function(e){var t=n._remoteStream=e.stream||e.streams[0];n._isSinkSupported?n._onAddTrack(n,t):n._fallbackOnAddTrack(n,t),n._startPollingVolume()},i},a.prototype._setupChannel=function(){var e=this,t=this,n=this.version.pc;t.version.pc.onopen=function(){t.status="open",t.onopen()},t.version.pc.onstatechange=function(){t.version.pc&&"stable"===t.version.pc.readyState&&(t.status="open",t.onopen())},t.version.pc.onsignalingstatechange=function(){t.log('signalingState is "'+n.signalingState+'"'),t.version.pc&&"stable"===t.version.pc.signalingState&&(t.status="open",t.onopen()),t.onsignalingstatechange(n.signalingState)},n.onicecandidate=function(e){t.onicecandidate(e.candidate)},n.oniceconnectionstatechange=function(){var i,r=n.iceConnectionState,o=e._iceState;switch(e._iceState=r,r){case"connected":"disconnected"===o&&(t.log(i="ICE liveliness check succeeded. Connection with Twilio restored"),t.onreconnect(i));break;case"disconnected":t.log(i="ICE liveliness check failed. May be having trouble connecting to Twilio"),t.ondisconnect(i);break;case"failed":t.log(i=("checking"===o?"ICE negotiation with Twilio failed.":"Connection with Twilio was interrupted.")+" Call will terminate."),t.onerror({info:{code:31003,message:i},disconnect:!0});break;default:t.log('iceConnectionState is "'+r+'"')}t.oniceconnectionstatechange(r)}},a.prototype._initializeMediaStream=function(e,t){return"open"!==this.status&&("disconnected"===this.pstream.status?(this.onerror({info:{code:31e3,message:"Cannot establish connection. Client is disconnected"}}),this.close(),!1):(this.version=this._setupPeerConnection(e,t),this._setupChannel(),!0))},a.prototype.makeOutgoingCall=function(e,t,n,i,r,o){if(this._initializeMediaStream(i,r)){var s=this;this.callSid=n,this._onAnswerOrRinging=function(e){e.sdp&&(s._answerSdp=e.sdp,"closed"!==s.status&&s.version.processAnswer(e.sdp,a,c),s.pstream.removeListener("answer",s._onAnswerOrRinging),s.pstream.removeListener("ringing",s._onAnswerOrRinging))},this.pstream.on("answer",this._onAnswerOrRinging),this.pstream.on("ringing",this._onAnswerOrRinging),this.version.createOffer({audio:!0},function(){"closed"!==s.status&&s.pstream.publish("invite",{sdp:s.version.getSDP(),callsid:s.callSid,twilio:{params:t}})},function(e){s.onerror({info:{code:31e3,message:"Error creating the offer: "+(e.message||e)}})})}function a(){o(s.version.pc)}function c(e){s.onerror({info:{code:31e3,message:"Error processing answer: "+(e.message||e)}})}},a.prototype.answerIncomingCall=function(e,t,n,i,r){if(this._initializeMediaStream(n,i)){this._answerSdp=t.replace(/^a=setup:actpass$/gm,"a=setup:passive"),this.callSid=e;var o=this;this.version.processSDP(t,{audio:!0},function(){"closed"!==o.status&&(o.pstream.publish("answer",{callsid:e,sdp:o.version.getSDP()}),r(o.version.pc))},function(e){o.onerror({info:{code:31e3,message:"Error creating the answer: "+(e.message||e)}})})}},a.prototype.close=function(){this.version&&this.version.pc&&("closed"!==this.version.pc.signalingState&&this.version.pc.close(),this.version.pc=null),this.stream&&(this.mute(!1),this._stopStream(this.stream)),this.stream=null,this.pstream&&this.pstream.removeListener("answer",this._onAnswerOrRinging),this._removeAudioOutputs(),this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._inputAnalyser&&this._inputAnalyser.disconnect(),this._outputAnalyser&&this._outputAnalyser.disconnect(),this.status="closed",this.onclose()},a.prototype.reject=function(e){this.callSid=e},a.prototype.ignore=function(e){this.callSid=e},a.prototype.mute=function(e){this.isMuted=e,this.stream&&("function"==typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks).forEach(function(t){t.enabled=!e})},a.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender||this._dtmfSenderUnsupported)return this._dtmfSender||null;var e=this,t=this.version.pc;if(!t)return this.log("No RTCPeerConnection available to call createDTMFSender on"),null;if("function"==typeof t.getSenders&&("function"==typeof RTCDTMFSender||"function"==typeof RTCDtmfSender)){var n=t.getSenders().find(function(e){return e.dtmf});if(n)return this.log("Using RTCRtpSender#dtmf"),this._dtmfSender=n.dtmf,this._dtmfSender}if("function"==typeof t.createDTMFSender&&"function"==typeof t.getLocalStreams){var i=t.getLocalStreams().map(function(t){var n=e._getAudioTracks(t);return n&&n[0]})[0];return i?(this.log("Creating RTCDTMFSender"),this._dtmfSender=t.createDTMFSender(i),this._dtmfSender):(this.log("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender"),null)}return this.log("RTCPeerConnection does not support RTCDTMFSender"),this._dtmfSenderUnsupported=!0,null},a.prototype._canStopMediaStreamTrack=function(){return"function"==typeof MediaStreamTrack.prototype.stop},a.prototype._getAudioTracks=function(e){return"function"==typeof e.getAudioTracks?e.getAudioTracks():e.audioTracks},a.prototype._getProtocol=function(){return a.protocol},a.protocol=o.test()?new o:null,a.enabled=!!a.protocol,t.exports=a},{"../log":9,"../util":26,"./rtcpc":19}],19:[function(e,t,n){(function(n){var i=e("rtcpeerconnection-shim"),r=e("../util");function o(){"undefined"!=typeof window?r.isEdge()?this.RTCPeerConnection=new i("undefined"!=typeof window?window:n):"function"==typeof window.RTCPeerConnection?this.RTCPeerConnection=window.RTCPeerConnection:"function"==typeof window.webkitRTCPeerConnection?this.RTCPeerConnection=webkitRTCPeerConnection:"function"==typeof window.mozRTCPeerConnection?(this.RTCPeerConnection=mozRTCPeerConnection,window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate):this.log("No RTCPeerConnection implementation available"):this.log("No RTCPeerConnection implementation available. The window object was not found.")}function s(e,t,n){return function(){var i=Array.prototype.slice.call(arguments);return new Promise(function(n){n(e.apply(t,i))}).catch(function(){return new Promise(function(r,o){e.apply(t,n?[r,o].concat(i):i.concat([r,o]))})})}}function a(e,t){return s(e,t,!0)}function c(e,t){return s(e,t,!1)}o.prototype.create=function(e,t,n){this.log=e,this.pc=new this.RTCPeerConnection({iceServers:n},t)},o.prototype.createModernConstraints=function(e){if(void 0===e)return null;var t={};return"undefined"==typeof webkitRTCPeerConnection||r.isEdge()?(void 0!==e.audio&&(t.offerToReceiveAudio=e.audio),void 0!==e.video&&(t.offerToReceiveVideo=e.video)):(t.mandatory={},void 0!==e.audio&&(t.mandatory.OfferToReceiveAudio=e.audio),void 0!==e.video&&(t.mandatory.OfferToReceiveVideo=e.video)),t},o.prototype.createOffer=function(e,t,n){var i=this;e=this.createModernConstraints(e),a(this.pc.createOffer,this.pc)(e).then(function(e){return i.pc&&c(i.pc.setLocalDescription,i.pc)(new RTCSessionDescription(e))}).then(t,n)},o.prototype.createAnswer=function(e,t,n){var i=this;e=this.createModernConstraints(e),a(this.pc.createAnswer,this.pc)(e).then(function(e){return i.pc&&c(i.pc.setLocalDescription,i.pc)(new RTCSessionDescription(e))}).then(t,n)},o.prototype.processSDP=function(e,t,n,i){var r=this,o=new RTCSessionDescription({sdp:e,type:"offer"});c(this.pc.setRemoteDescription,this.pc)(o).then(function(){r.createAnswer(t,n,i)})},o.prototype.getSDP=function(){return this.pc.localDescription.sdp},o.prototype.processAnswer=function(e,t,n){this.pc&&c(this.pc.setRemoteDescription,this.pc)(new RTCSessionDescription({sdp:e,type:"answer"})).then(t,n)},o.test=function(){if("object"==typeof navigator){var e=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;if(e&&"function"==typeof window.RTCPeerConnection)return!0;if(e&&"function"==typeof window.webkitRTCPeerConnection)return!0;if(e&&"function"==typeof window.mozRTCPeerConnection){try{if("function"!=typeof(new window.mozRTCPeerConnection).getLocalStreams)return!1}catch(e){return!1}return!0}if("undefined"!=typeof RTCIceGatherer)return!0}return!1},t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":26,"rtcpeerconnection-shim":47}],20:[function(e,t,n){var i=e("./mockrtcstatsreport"),r=32767,o=!1;if("undefined"!=typeof window){var s=!!window.navigator.userAgent.match("CriOS"),a=!!window.navigator.userAgent.match("Electron"),c=void 0!==window.chrome&&"Google Inc."===window.navigator.vendor&&-1===window.navigator.userAgent.indexOf("OPR")&&-1===window.navigator.userAgent.indexOf("Edge");o=s||a||c}function u(e){var t,n=null,i=new function(){};Array.from(e.values()).forEach(function(o){var s=o.type.replace("-","");switch(t=t||o.timestamp,s){case"inboundrtp":i.timestamp=i.timestamp||o.timestamp,i.jitter=1e3*o.jitter,i.packetsLost=o.packetsLost,i.packetsReceived=o.packetsReceived,i.bytesReceived=o.bytesReceived;var a=e.get(o.trackId);a&&(i.audioOutputLevel=a.audioLevel*r);break;case"outboundrtp":if(i.timestamp=o.timestamp,i.packetsSent=o.packetsSent,i.bytesSent=o.bytesSent,o.codecId&&e.get(o.codecId)){var c=e.get(o.codecId).mimeType;i.codecName=c&&c.match(/(.*\/)?(.*)/)[2]}var u=e.get(o.trackId);u&&(i.audioInputLevel=u.audioLevel*r);break;case"transport":"connected"===o.dtlsState&&(n=o.id)}}),i.timestamp||(i.timestamp=t);var o=e.get(n);if(!o)return i;var s=e.get(o.selectedCandidatePairId);if(!s)return i;var a=e.get(s.localCandidateId),c=e.get(s.remoteCandidateId);return Object.assign(i,{localAddress:a&&a.ip,remoteAddress:c&&c.ip,rtt:s&&1e3*s.currentRoundTripTime}),i}t.exports=function(e,t){if(t=Object.assign({createRTCSample:u},t),!e)return Promise.reject(new Error("PeerConnection is null"));if("function"!=typeof e.getStats)return Promise.reject(new Error("WebRTC statistics are unsupported"));if(o)return new Promise(function(t,n){return e.getStats(t,n)}).then(i.fromRTCStatsResponse).then(t.createRTCSample);var n;try{n=e.getStats()}catch(t){n=new Promise(function(t,n){return e.getStats(t,n)}).then(i.fromRTCStatsResponse)}return n.then(t.createRTCSample)}},{"./mockrtcstatsreport":15}],21:[function(e,t,n){var i=e("events").EventEmitter;function r(){Object.defineProperties(this,{_eventEmitter:{value:new i},_handlers:{value:{}}})}r.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},r.prototype.addEventListener=function(){var e;return(e=this._eventEmitter).addListener.apply(e,arguments)},r.prototype.removeEventListener=function(){var e;return(e=this._eventEmitter).removeListener.apply(e,arguments)},r.prototype._defineEventHandler=function(e){var t=this;Object.defineProperty(this,"on"+e,{get:function(){return t._handlers[e]},set:function(n){var i=t._handlers[e];!i||"function"!=typeof n&&void 0!==n&&null!==n||(t._handlers[e]=null,t.removeEventListener(e,i)),"function"==typeof n&&(t._handlers[e]=n,t.addEventListener(e,n))}})},t.exports=r},{events:39}],22:[function(e,t,n){t.exports=function(e){Object.defineProperties(this,{deviceId:{get:function(){return e.deviceId}},groupId:{get:function(){return e.groupId}},kind:{get:function(){return e.kind}},label:{get:function(){return e.label}}})}},{}],23:[function(e,t,n){var i=e("./eventtarget"),r=e("util").inherits,o=500,s="undefined"!=typeof navigator&&navigator.mediaDevices;function a(){i.call(this),this._defineEventHandler("devicechange"),this._defineEventHandler("deviceinfochange");var e=[];Object.defineProperties(this,{_deviceChangeIsNative:{value:c(this,"devicechange")},_deviceInfoChangeIsNative:{value:c(this,"deviceinfochange")},_knownDevices:{value:e},_pollInterval:{value:null,writable:!0}}),"function"==typeof s.enumerateDevices&&s.enumerateDevices().then(function(t){t.sort(u).forEach([].push,e)}),this._eventEmitter.on("newListener",(function(e){"devicechange"!==e&&"deviceinfochange"!==e||(this._pollInterval=this._pollInterval||setInterval((function(e){s.enumerateDevices().then(function(t){var n=e._knownDevices,i=n.slice();[].splice.apply(n,[0,n.length].concat(t.sort(u))),!e._deviceChangeIsNative&&function(e,t){return n.length!==t.length||(i=t,n.some(function(e,t){return e.deviceId!==i[t].deviceId}));var i}(0,i)&&e.dispatchEvent(new Event("devicechange")),!e._deviceInfoChangeIsNative&&function(e,t){var n=t.reduce(function(e,t){return e.set(t.deviceId,t.label||null)},new Map);return e.some(function(e){var t=n.get(e.deviceId);return void 0!==t&&t!==e.label})}(n,i)&&e.dispatchEvent(new Event("deviceinfochange"))})}).bind(null,this),o))}).bind(this)),this._eventEmitter.on("removeListener",(function(){var e;!this._pollInterval||(e=this,["devicechange","deviceinfochange"].reduce(function(t,n){return t+e._eventEmitter.listenerCount(n)},0)>0)||(clearInterval(this._pollInterval),this._pollInterval=null)}).bind(this))}function c(e,t){var n="on"+t;function i(t){e.dispatchEvent(t)}return n in s&&("addEventListener"in s?s.addEventListener(t,i):s[n]=i,!0)}function u(e,t){return e.deviceId<t.deviceId}r(a,i),s&&"function"==typeof s.enumerateDevices&&(a.prototype.enumerateDevices=function(){return s.enumerateDevices.apply(s,arguments)}),a.prototype.getUserMedia=function(){return s.getUserMedia.apply(s,arguments)},t.exports=s?new a:null},{"./eventtarget":21,util:50}],24:[function(e,t,n){var i=e("@twilio/audioplayer");function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);if(!e||!t)throw new Error("name and url are required arguments");(n=Object.assign({AudioFactory:"undefined"!=typeof Audio?Audio:null,maxDuration:0,shouldLoop:!1},n)).AudioPlayer=n.audioContext?i.bind(i,n.audioContext):n.AudioFactory,Object.defineProperties(this,{_activeEls:{value:new Set},_Audio:{value:n.AudioPlayer},_isSinkSupported:{value:null!==n.AudioFactory&&"function"==typeof n.AudioFactory.prototype.setSinkId},_maxDuration:{value:n.maxDuration},_maxDurationTimeout:{value:null,writable:!0},_playPromise:{value:null,writable:!0},_shouldLoop:{value:n.shouldLoop},_sinkIds:{value:["default"]},isPlaying:{enumerable:!0,get:function(){return!!this._playPromise}},name:{enumerable:!0,value:e},url:{enumerable:!0,value:t}}),this._Audio&&function(e,t){var n=new e(t);n.preload="auto",n.muted=!0,n.play()}(this._Audio,t)}r.prototype.setSinkIds=function(e){this._isSinkSupported&&[].splice.apply(this._sinkIds,[0,this._sinkIds.length].concat(e=e.forEach?e:[e]))},r.prototype.stop=function(){this._activeEls.forEach(function(e){e.pause(),e.src="",e.load()}),this._activeEls.clear(),clearTimeout(this._maxDurationTimeout),this._playPromise=null,this._maxDurationTimeout=null},r.prototype.play=function(){this.isPlaying&&this.stop(),this._maxDuration>0&&(this._maxDurationTimeout=setTimeout(this.stop.bind(this),this._maxDuration));var e=this,t=this._playPromise=Promise.all(this._sinkIds.map(function(n){if(!e._Audio)return Promise.resolve();var i=new e._Audio(e.url);return i.loop=e._shouldLoop,i.addEventListener("ended",function(){e._activeEls.delete(i)}),new Promise(function(e){i.addEventListener("canplaythrough",e)}).then(function(){return e.isPlaying&&e._playPromise===t?(e._isSinkSupported?i.setSinkId(n):Promise.resolve()).then(function(){return e._activeEls.add(i),i.play()}).then(function(){return i},function(t){throw e._activeEls.delete(i),t}):Promise.resolve()})}));return t},t.exports=r},{"@twilio/audioplayer":31}],25:[function(e,t,n){"use strict";var i,r,o;Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.Off="off",e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error"}(o=n.LogLevel||(n.LogLevel={}));var s=((i={})[o.Debug]="info",i[o.Info]="info",i[o.Warn]="warn",i[o.Error]="error",i),a=((r={})[o.Debug]=0,r[o.Info]=1,r[o.Warn]=2,r[o.Error]=3,r[o.Off]=4,r),c=function(){function e(e,t){this._logLevel=e,this._console=console,t&&t.console&&(this._console=t.console)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},enumerable:!0,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,[o.Debug].concat(e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,[o.Error].concat(e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,[o.Info].concat(e))},e.prototype.log=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var r=s[e];r&&a[this.logLevel]<=a[e]&&(t=this._console)[r].apply(t,n)},e.prototype.setLogLevel=function(e){this._logLevel=e},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,[o.Warn].concat(e))},e}();n.default=c},{}],26:[function(e,t,n){(function(e){function t(e){if(!(this instanceof t))return new t(e);this.message=e}t.prototype.toString=function(){return"Twilio.Exception: "+this.message},n.Exception=t,n.average=function(e){return e.reduce(function(e,t){return e+t})/e.length},n.difference=function(e,t,n){n=n||function(e){return e};var i=new Set(t.map(n));return e.filter(function(e){return!i.has(n(e))})},n.isFirefox=function(t){return(t=t||("undefined"==typeof window?e.navigator:window.navigator))&&"string"==typeof t.userAgent&&/firefox|fxios/i.test(t.userAgent)},n.isEdge=function(t){return(t=t||("undefined"==typeof window?e.navigator:window.navigator))&&"string"==typeof t.userAgent&&/edge\/\d+/i.test(t.userAgent)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,s=e("events"),a=e("ws"),c=e("./tslog"),u=e("backoff");!function(e){e.Connecting="connecting",e.Closed="closed",e.Open="open"}(o=n.WSTransportState||(n.WSTransportState={}));var l=function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this)||this;return i.state=o.Closed,i._backoff=u.exponential({factor:1.5,initialDelay:30,maxDelay:3e3,randomisationFactor:.25}),i._onSocketClose=function(){i._closeSocket()},i._onSocketError=function(e){i._log.info("WebSocket received error: "+e.message),i.emit("error",{code:31e3,message:e.message||"WSTransport socket error"})},i._onSocketMessage=function(e){i._setHeartbeatTimeout(),i._socket&&"\n"===e.data?i._socket.send("\n"):i.emit("message",e)},i._onSocketOpen=function(){i._log.info("WebSocket opened successfully."),i._timeOpened=Date.now(),i.state=o.Open,clearTimeout(i._connectTimeout),i._setHeartbeatTimeout(),i.emit("open")},i._log=new c.default(n.logLevel||c.LogLevel.Off),i._uri=t,i._WebSocket=n.WebSocket||a,i._backoff.on("backoff",function(e,t){i.state!==o.Closed&&i._log.info("Will attempt to reconnect WebSocket in "+t+"ms")}),i._backoff.on("ready",function(e){i.state!==o.Closed&&i._connect(e+1)}),i}return r(t,e),t.prototype.close=function(){this._log.info("WSTransport.close() called..."),this._close()},t.prototype.open=function(){this._log.info("WSTransport.open() called..."),!this._socket||this._socket.readyState!==a.CONNECTING&&this._socket.readyState!==a.OPEN?this._connect():this._log.info("WebSocket already open.")},t.prototype.send=function(e){if(!this._socket||this._socket.readyState!==a.OPEN)return!1;try{this._socket.send(e)}catch(e){return this._log.info("Error while sending message:",e.message),this._closeSocket(),!1}return!0},t.prototype._close=function(){this.state=o.Closed,this._closeSocket()},t.prototype._closeSocket=function(){clearTimeout(this._connectTimeout),clearTimeout(this._heartbeatTimeout),this._log.info("Closing and cleaning up WebSocket..."),this._socket?(this._socket.removeEventListener("close",this._onSocketClose),this._socket.removeEventListener("error",this._onSocketError),this._socket.removeEventListener("message",this._onSocketMessage),this._socket.removeEventListener("open",this._onSocketOpen),this._socket.readyState!==a.CONNECTING&&this._socket.readyState!==a.OPEN||this._socket.close(),this._timeOpened&&Date.now()-this._timeOpened>1e4&&this._backoff.reset(),this._backoff.backoff(),delete this._socket,this.emit("close")):this._log.info("No WebSocket to clean up.")},t.prototype._connect=function(e){var t=this;this._log.info(e?"Attempting to reconnect (retry #"+e+")...":"Attempting to connect..."),this._closeSocket(),this.state=o.Connecting;var n=null;try{n=new this._WebSocket(this._uri)}catch(e){return this._log.info("Could not connect to endpoint:",e.message),this._close(),void this.emit("error",{code:31e3,message:e.message||"Could not connect to "+this._uri})}delete this._timeOpened,this._connectTimeout=setTimeout(function(){t._log.info("WebSocket connection attempt timed out."),t._closeSocket()},5e3),n.addEventListener("close",this._onSocketClose),n.addEventListener("error",this._onSocketError),n.addEventListener("message",this._onSocketMessage),n.addEventListener("open",this._onSocketOpen),this._socket=n},t.prototype._setHeartbeatTimeout=function(){var e=this;clearTimeout(this._heartbeatTimeout),this._heartbeatTimeout=setTimeout(function(){e._log.info("No messages received in 15 seconds. Reconnecting..."),e._closeSocket()},15e3)},t}(s.EventEmitter);n.default=l},{"./tslog":25,backoff:33,events:39,ws:1}],28:[function(e,t,n){"use strict";var i,r=(i=e("babel-runtime/regenerator"))&&i.__esModule?i:{default:i},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Deferred"),c=e("./EventTarget"),u=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._audioNode=null,r._pendingPlayDeferreds=[],r._loop=!1,r._src="",r._sinkId="default","string"!=typeof n&&(i=n),r._audioContext=e,r._audioElement=new(i.AudioFactory||Audio),r._bufferPromise=r._createPlayDeferred().promise,r._destination=r._audioContext.destination,r._gainNode=r._audioContext.createGain(),r._gainNode.connect(r._destination),r._XMLHttpRequest=i.XMLHttpRequestFactory||XMLHttpRequest,r.addEventListener("canplaythrough",function(){r._resolvePlayDeferreds()}),"string"==typeof n&&(r.src=n),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default),o(t,[{key:"load",value:function(){this._load(this._src)}},{key:"pause",value:function(){this.paused||(this._audioElement.pause(),this._audioNode.stop(),this._audioNode.disconnect(this._gainNode),this._audioNode=null,this._rejectPlayDeferreds(new Error("The play() request was interrupted by a call to pause().")))}},{key:"play",value:function(){return s(this,void 0,void 0,r.default.mark(function e(){var t,n=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.paused){e.next=6;break}return e.next=3,this._bufferPromise;case 3:if(this.paused){e.next=5;break}return e.abrupt("return");case 5:throw new Error("The play() request was interrupted by a call to pause().");case 6:return this._audioNode=this._audioContext.createBufferSource(),this._audioNode.loop=this.loop,this._audioNode.addEventListener("ended",function(){n._audioNode&&n._audioNode.loop||n.dispatchEvent("ended")}),e.next=11,this._bufferPromise;case 11:if(t=e.sent,!this.paused){e.next=14;break}throw new Error("The play() request was interrupted by a call to pause().");case 14:if(this._audioNode.buffer=t,this._audioNode.connect(this._gainNode),this._audioNode.start(),!this._audioElement.srcObject){e.next=19;break}return e.abrupt("return",this._audioElement.play());case 19:case"end":return e.stop()}},e,this)}))}},{key:"setSinkId",value:function(e){return s(this,void 0,void 0,r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof this._audioElement.setSinkId){t.next=2;break}throw new Error("This browser does not support setSinkId.");case 2:if(e!==this.sinkId){t.next=4;break}return t.abrupt("return");case 4:if("default"!==e){t.next=11;break}return this.paused||this._gainNode.disconnect(this._destination),this._audioElement.srcObject=null,this._destination=this._audioContext.destination,this._gainNode.connect(this._destination),this._sinkId=e,t.abrupt("return");case 11:return t.next=13,this._audioElement.setSinkId(e);case 13:if(!this._audioElement.srcObject){t.next=15;break}return t.abrupt("return");case 15:this._gainNode.disconnect(this._audioContext.destination),this._destination=this._audioContext.createMediaStreamDestination(),this._audioElement.srcObject=this._destination.stream,this._sinkId=e,this._gainNode.connect(this._destination);case 20:case"end":return t.stop()}},t,this)}))}},{key:"_createPlayDeferred",value:function(){var e=new a.default;return this._pendingPlayDeferreds.push(e),e}},{key:"_load",value:function(e){var t=this;this._src&&this._src!==e&&this.pause(),this._src=e,this._bufferPromise=new Promise(function(n,i){return s(t,void 0,void 0,r.default.mark(function t(){var i;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",this._createPlayDeferred().promise);case 2:return t.next=4,l(this._audioContext,this._XMLHttpRequest,e);case 4:i=t.sent,this.dispatchEvent("canplaythrough"),n(i);case 7:case"end":return t.stop()}},t,this)}))})}},{key:"_rejectPlayDeferreds",value:function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach(function(t){return(0,t.reject)(e)})}},{key:"_resolvePlayDeferreds",value:function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach(function(t){return(0,t.resolve)(e)})}},{key:"destination",get:function(){return this._destination}},{key:"loop",get:function(){return this._loop},set:function(e){if(!e&&this.loop&&!this.paused){var t=this;this._audioNode.addEventListener("ended",function e(){t._audioNode.removeEventListener("ended",e),t.pause()})}this._loop=e}},{key:"muted",get:function(){return 0===this._gainNode.gain.value},set:function(e){this._gainNode.gain.value=e?0:1}},{key:"paused",get:function(){return null===this._audioNode}},{key:"src",get:function(){return this._src},set:function(e){this._load(e)}},{key:"sinkId",get:function(){return this._sinkId}}]),t}();function l(e,t,n){return s(this,void 0,void 0,r.default.mark(function i(){var o,s;return r.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return(o=new t).open("GET",n,!0),o.responseType="arraybuffer",i.next=5,new Promise(function(e){o.addEventListener("load",e),o.send()});case 5:return s=i.sent,i.prev=6,i.abrupt("return",e.decodeAudioData(s.target.response));case 10:return i.prev=10,i.t0=i.catch(6),i.abrupt("return",new Promise(function(t){e.decodeAudioData(s.target.response,t)}));case 13:case"end":return i.stop()}},i,this,[[6,10]])}))}n.default=u},{"./Deferred":29,"./EventTarget":30,"babel-runtime/regenerator":32}],29:[function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){var t=this;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return i(e,[{key:"reject",get:function(){return this._reject}},{key:"resolve",get:function(){return this._resolve}}]),e}();n.default=r},{}],30:[function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0});var r=e("events"),o=function(){function e(){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this._eventEmitter=new r.EventEmitter}return i(e,[{key:"addEventListener",value:function(e,t){return this._eventEmitter.addListener(e,t)}},{key:"dispatchEvent",value:function(e){for(var t,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return(t=this._eventEmitter).emit.apply(t,[e].concat(i))}},{key:"removeEventListener",value:function(e,t){return this._eventEmitter.removeListener(e,t)}}]),e}();n.default=o},{events:39}],31:[function(e,t,n){"use strict";var i=e("./AudioPlayer");t.exports=i.default},{"./AudioPlayer":28}],32:[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":45}],33:[function(e,t,n){var i=e("./lib/backoff"),r=e("./lib/strategy/exponential"),o=e("./lib/strategy/fibonacci"),s=e("./lib/function_call.js");t.exports.Backoff=i,t.exports.FunctionCall=s,t.exports.FibonacciStrategy=o,t.exports.ExponentialStrategy=r,t.exports.fibonacci=function(e){return new i(new o(e))},t.exports.exponential=function(e){return new i(new r(e))},t.exports.call=function(e,t,n){var i=Array.prototype.slice.call(arguments);return e=i[0],t=i.slice(1,i.length-1),new s(e,t,i[i.length-1])}},{"./lib/backoff":34,"./lib/function_call.js":35,"./lib/strategy/exponential":36,"./lib/strategy/fibonacci":37}],34:[function(e,t,n){var i=e("events"),r=e("precond");function o(e){i.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}e("util").inherits(o,i.EventEmitter),o.prototype.failAfter=function(e){r.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},o.prototype.backoff=function(e){r.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},o.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},o.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},t.exports=o},{events:39,precond:41,util:50}],35:[function(e,t,n){var i=e("events"),r=e("precond"),o=e("util"),s=e("./backoff"),a=e("./strategy/fibonacci");function c(e,t,n){i.EventEmitter.call(this),r.checkIsFunction(e,"Expected fn to be a function."),r.checkIsArray(t,"Expected args to be an array."),r.checkIsFunction(n,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=n,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=c.DEFAULT_RETRY_PREDICATE_,this.state_=c.State_.PENDING}o.inherits(c,i.EventEmitter),c.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},c.DEFAULT_RETRY_PREDICATE_=function(e){return!0},c.prototype.isPending=function(){return this.state_==c.State_.PENDING},c.prototype.isRunning=function(){return this.state_==c.State_.RUNNING},c.prototype.isCompleted=function(){return this.state_==c.State_.COMPLETED},c.prototype.isAborted=function(){return this.state_==c.State_.ABORTED},c.prototype.setStrategy=function(e){return r.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},c.prototype.retryIf=function(e){return r.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},c.prototype.getLastResult=function(){return this.lastResult_.concat()},c.prototype.getNumRetries=function(){return this.numRetries_},c.prototype.failAfter=function(e){return r.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},c.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=c.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},c.prototype.start=function(e){r.checkState(!this.isAborted(),"FunctionCall is aborted."),r.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new a;this.backoff_=e?e(t):new s(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=c.State_.RUNNING,this.doCall_(!1)},c.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);i.EventEmitter.prototype.emit.apply(this,t);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},c.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},c.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,i.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=c.State_.COMPLETED,this.doCallback_())}},c.prototype.handleBackoff_=function(e,t,n){this.emit("backoff",e,t,n)},t.exports=c},{"./backoff":34,"./strategy/fibonacci":37,events:39,precond:41,util:50}],36:[function(e,t,n){var i=e("util"),r=e("precond"),o=e("./strategy");function s(e){o.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=s.DEFAULT_FACTOR,e&&void 0!==e.factor&&(r.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}i.inherits(s,o),s.DEFAULT_FACTOR=2,s.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},s.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},t.exports=s},{"./strategy":38,precond:41,util:50}],37:[function(e,t,n){var i=e("util"),r=e("./strategy");function o(e){r.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}i.inherits(o,r),o.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},o.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},t.exports=o},{"./strategy":38,util:50}],38:[function(e,t,n){function i(e){return void 0!==e&&null!==e}function r(e){if(i((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(i(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(i(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}e("events"),e("util"),r.prototype.getMaxDelay=function(){return this.maxDelay_},r.prototype.getInitialDelay=function(){return this.initialDelay_},r.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},r.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},r.prototype.reset=function(){this.reset_()},r.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},t.exports=r},{events:39,util:50}],39:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(s(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),i=(u=n.slice()).length,c=0;c<i;c++)u[c].apply(this,a);return!0},i.prototype.on=i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var n,i,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(n=this._events[e]).length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],40:[function(e,t,n){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],41:[function(e,t,n){t.exports=e("./lib/checks")},{"./lib/checks":42}],42:[function(e,t,n){var i=e("util"),r=t.exports=e("./errors");function o(e,t,n,r){var o=new e(i.format.apply(this,[n=n||""].concat(r)));throw Error.captureStackTrace(o,t),o}function s(e,t,n){o(r.IllegalArgumentError,e,t,n)}function a(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function c(e){return function(t,n){var i=a(t);if(i==e)return t;s(arguments.callee,n||'Expected "'+e+'" but got "'+i+'".',Array.prototype.slice.call(arguments,2))}}t.exports.checkArgument=function(e,t){e||s(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkState=function(e,t){e||function(e,t,n){o(r.IllegalStateError,e,t,n)}(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkIsDef=function(e,t){if(void 0!==e)return e;s(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},t.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;s(arguments.callee,t||'Expected value to be defined and not null but got "'+a(e)+'".',Array.prototype.slice.call(arguments,2))},t.exports.checkIsString=c("string"),t.exports.checkIsArray=c("array"),t.exports.checkIsNumber=c("number"),t.exports.checkIsBoolean=c("boolean"),t.exports.checkIsFunction=c("function"),t.exports.checkIsObject=c("object")},{"./errors":43,util:50}],43:[function(e,t,n){var i=e("util");function r(e){Error.call(this,e),this.message=e}function o(e){Error.call(this,e),this.message=e}i.inherits(r,Error),r.prototype.name="IllegalArgumentError",i.inherits(o,Error),o.prototype.name="IllegalStateError",t.exports.IllegalStateError=o,t.exports.IllegalArgumentError=r},{util:50}],44:[function(e,t,n){var i,r,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,l=[],d=!1,p=-1;function f(){d&&u&&(d=!1,u.length?l=u.concat(l):p=-1,l.length&&h())}function h(){if(!d){var e=c(f);d=!0;for(var t=l.length;t;){for(u=l,l=[];++p<t;)u&&u[p].run();p=-1,t=l.length}u=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new m(e,t)),1!==l.length||d||c(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],45:[function(e,t,n){var i=function(){return this}()||Function("return this")(),r=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,o=r&&i.regeneratorRuntime;if(i.regeneratorRuntime=void 0,t.exports=e("./runtime"),r)i.regeneratorRuntime=o;else try{delete i.regeneratorRuntime}catch(e){i.regeneratorRuntime=void 0}},{"./runtime":46}],46:[function(e,t,n){!function(e){"use strict";var n,i=Object.prototype,r=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",u="object"==typeof t,l=e.regeneratorRuntime;if(l)u&&(t.exports=l);else{(l=e.regeneratorRuntime=u?t.exports:{}).wrap=b;var d="suspendedStart",p="suspendedYield",f="executing",h="completed",m={},v={};v[s]=function(){return this};var g=Object.getPrototypeOf,y=g&&g(g(R([])));y&&y!==i&&r.call(y,s)&&(v=y);var _=E.prototype=S.prototype=Object.create(v);k.prototype=_.constructor=E,E.constructor=k,E[c]=k.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(_),e},l.awrap=function(e){return{__await:e}},C(T.prototype),T.prototype[a]=function(){return this},l.AsyncIterator=T,l.async=function(e,t,n,i){var r=new T(b(e,t,n,i));return l.isGeneratorFunction(t)?r:r.next().then(function(e){return e.done?e.value:r.next()})},C(_),_[c]="Generator",_[s]=function(){return this},_.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},l.values=R,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(D),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){return a.type="throw",a.arg=e,t.next=i,r&&(t.method="next",t.arg=n),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;D(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:R(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=n),m}}}function b(e,t,n,i){var r=Object.create((t&&t.prototype instanceof S?t:S).prototype),o=new I(i||[]);return r._invoke=function(e,t,n){var i=d;return function(r,o){if(i===f)throw new Error("Generator is already running");if(i===h){if("throw"===r)throw o;return L()}for(n.method=r,n.arg=o;;){var s=n.delegate;if(s){var a=x(s,n);if(a){if(a===m)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===d)throw i=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var c=w(e,t,n);if("normal"===c.type){if(i=n.done?h:p,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=h,n.method="throw",n.arg=c.arg)}}}(e,n,o),r}function w(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function S(){}function k(){}function E(){}function C(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(e){var t;this._invoke=function(n,i){function o(){return new Promise(function(t,o){!function t(n,i,o,s){var a=w(e[n],e,i);if("throw"!==a.type){var c=a.arg,u=c.value;return u&&"object"==typeof u&&r.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,o,s)},function(e){t("throw",e,o,s)}):Promise.resolve(u).then(function(e){c.value=e,o(c)},s)}s(a.arg)}(n,i,t,o)})}return t=t?t.then(o,o):o()}}function x(e,t){var i=e.iterator[t.method];if(i===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,x(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var r=w(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,m;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function R(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}return{next:L}}function L(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},{}],47:[function(e,t,n){"use strict";var i=e("sdp");function r(e,t,n,r,o){var s=i.writeRtpDescription(e.kind,t);if(s+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),s+="a=mid:"+e.mid+"\r\n",s+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(r?r.id:"-")+" "+a+"\r\n";s+="a="+c,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),s}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},r=function(e,t,n,r){var o=i(e.parameters.apt,n),s=i(t.parameters.apt,r);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(i){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(i.name.toLowerCase()===s.name.toLowerCase()&&i.clockRate===s.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&s.parameters.apt&&!r(i,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(i.numChannels,s.numChannels),n.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}}),n}function s(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function a(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,i,r){var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=r,e.setTimeout(function(){t._dispatchEvent("track",o)})}var l=function(n){var r=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof i;return r&&(i=[i]),i=i.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=r?i[0]:i,!!i.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var s=n.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=i.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},l.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==t.kind||(i=this.transceivers[r]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),i.track=t,i.stream=n,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},l.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var i=e.clone();e.getTracks().forEach(function(e,t){var n=i.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),i.getTracks().forEach(function(e){n.addTrack(e,i)})}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var i=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},l.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},l.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},l.prototype._createIceGatherer=function(t,n){var i=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;r.state=n?"completed":"gathering",null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)},r.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),r},l.prototype._gather=function(t,n){var r=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var s=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),a.component=1,a.ufrag=o.getLocalParameters().usernameFragment;var u=i.writeCandidate(a);s.candidate=Object.assign(s.candidate,i.parseCandidate(u)),s.candidate.candidate=u,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var l=i.getMediaSections(r._localDescription.sdp);l[s.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",r._localDescription.sdp=i.getDescription(r._localDescription.sdp)+l.join("");var d=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),c||r._dispatchEvent("icecandidate",s),d&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){s.forEach(function(e){o.onlocalcandidate(e)})},0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new e.RTCDtlsTransport(n);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:i}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,n,r){var s=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:i.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),r&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),s.encodings=e.recvEncodingParameters.length?e.recvEncodingParameters:[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},l.prototype.setLocalDescription=function(e){var t,n,r=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,r.signalingState)||r._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+r.signalingState));if("offer"===e.type)t=i.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=i.parseRtpParameters(e);r.transceivers[t].localCapabilities=n}),r.transceivers.forEach(function(e,t){r._gather(e.mid,t)});else if("answer"===e.type){t=i.splitSections(r._remoteDescription.sdp),n=t.shift();var a=i.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var s=r.transceivers[t],c=s.iceGatherer,u=s.iceTransport,l=s.dtlsTransport,d=s.localCapabilities,p=s.remoteCapabilities;if(!(i.isRejected(e)&&0===i.matchPrefix(e,"a=bundle-only").length||s.rejected)){var f=i.getIceParameters(e,n),h=i.getDtlsParameters(e,n);a&&(h.role="server"),r.usingBundle&&0!==t||(r._gather(s.mid,t),"new"===u.state&&u.start(c,f,a?"controlling":"controlled"),"new"===l.state&&l.start(h));var m=o(d,p);r._transceive(s,m.codecs.length>0,!1)}})}return r._localDescription={type:e.type,sdp:e.sdp},r._updateSignalingState("offer"===e.type?"have-local-offer":"stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(r){var o=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(c("TypeError",'Unsupported type "'+r.type+'"'));if(!s("setRemoteDescription",r.type,o.signalingState)||o._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+r.type+" in state "+o.signalingState));var l={};o.remoteStreams.forEach(function(e){l[e.id]=e});var d=[],p=i.splitSections(r.sdp),f=p.shift(),h=i.matchPrefix(f,"a=ice-lite").length>0,m=i.matchPrefix(f,"a=group:BUNDLE ").length>0;o.usingBundle=m;var v=i.matchPrefix(f,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,p.forEach(function(s,c){var u=i.splitLines(s),p=i.getKind(s),v=i.isRejected(s)&&0===i.matchPrefix(s,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],y=i.getDirection(s,f),_=i.parseMsid(s),b=i.getMid(s)||i.generateIdentifier();if(v||"application"===p&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))o.transceivers[c]={mid:b,kind:p,protocol:g,rejected:!0};else{var w,S,k,E,C,T,x,P,D;!v&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(p,!0));var I,R,L=i.parseRtpParameters(s);v||(I=i.getIceParameters(s,f),(R=i.getDtlsParameters(s,f)).role="client"),x=i.parseRtpEncodingParameters(s);var A=i.parseRtcpParameters(s),O=i.matchPrefix(s,"a=end-of-candidates",f).length>0,j=i.matchPrefix(s,"a=candidate:").map(function(e){return i.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===r.type||"answer"===r.type)&&!v&&m&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==r.type||v)"answer"!==r.type||v||(S=(w=o.transceivers[c]).iceGatherer,k=w.iceTransport,E=w.dtlsTransport,C=w.rtpReceiver,T=w.sendEncodingParameters,P=w.localCapabilities,o.transceivers[c].recvEncodingParameters=x,o.transceivers[c].remoteCapabilities=L,o.transceivers[c].rtcpParameters=A,j.length&&"new"===k.state&&(!h&&!O||m&&0!==c?j.forEach(function(e){a(w.iceTransport,e)}):k.setRemoteCandidates(j)),m&&0!==c||("new"===k.state&&k.start(S,I,"controlling"),"new"===E.state&&E.start(R)),o._transceive(w,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!C||"sendrecv"!==y&&"sendonly"!==y?delete w.rtpReceiver:(D=C.track,_?(l[_.stream]||(l[_.stream]=new e.MediaStream),n(D,l[_.stream]),d.push([D,C,l[_.stream]])):(l.default||(l.default=new e.MediaStream),n(D,l.default),d.push([D,C,l.default]))));else{(w=o.transceivers[c]||o._createTransceiver(p)).mid=b,w.iceGatherer||(w.iceGatherer=o._createIceGatherer(c,m)),j.length&&"new"===w.iceTransport.state&&(!O||m&&0!==c?j.forEach(function(e){a(w.iceTransport,e)}):w.iceTransport.setRemoteCandidates(j)),P=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),T=w.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var M,N=!1;"sendrecv"===y||"sendonly"===y?(N=!w.rtpReceiver,C=w.rtpReceiver||new e.RTCRtpReceiver(w.dtlsTransport,p),N&&(D=C.track,_&&"-"===_.stream||(_?(l[_.stream]||(l[_.stream]=new e.MediaStream,Object.defineProperty(l[_.stream],"id",{get:function(){return _.stream}})),Object.defineProperty(D,"id",{get:function(){return _.track}}),M=l[_.stream]):(l.default||(l.default=new e.MediaStream),M=l.default)),M&&(n(D,M),w.associatedRemoteMediaStreams.push(M)),d.push([D,C,M]))):w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach(function(t){var n,i,r=t.getTracks().find(function(e){return e.id===w.rtpReceiver.track.id});r&&((i=t).removeTrack(n=r),i.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:n})))}),w.associatedRemoteMediaStreams=[]),w.localCapabilities=P,w.remoteCapabilities=L,w.rtpReceiver=C,w.rtcpParameters=A,w.sendEncodingParameters=T,w.recvEncodingParameters=x,o._transceive(o.transceivers[c],!1,N)}}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===r.type?"active":"passive"),o._remoteDescription={type:r.type,sdp:r.sdp},o._updateSignalingState("offer"===r.type?"have-remote-offer":"stable"),Object.keys(l).forEach(function(t){var n=l[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout(function(){o._dispatchEvent("addstream",i)})}d.forEach(function(e){n.id===e[2].id&&u(o,e[0],e[1],[n])})}}),d.forEach(function(e){e[2]||u(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},l.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter(function(e){return"audio"===e.kind}).length,s=n.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(o=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(s=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)});o>0||s>0;)o>0&&(n._createTransceiver("audio"),o--),s>0&&(n._createTransceiver("video"),s--);var u=i.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(r,o){var s=r.track,a=r.kind,c=r.mid||i.generateIdentifier();r.mid=c,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(o,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(a);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var l=r.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];s&&t>=15019&&"video"===a&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,a)),r.localCapabilities=u,r.sendEncodingParameters=l}),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){u+=r(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,u+="a="+i.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))});var l=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(l)},l.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var s=i.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(s+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var a=i.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,i){if(!(i+1>a)){if(e.rejected)return"application"===e.kind?s+="DTLS/SCTP"===e.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=r(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}});var u=new e.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(u)},l.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(r,o){if(!n._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){s=u;break}var l=n.transceivers[s];if(!l)return o(c("OperationError","Can not add ICE candidate"));if(l.rejected)return r();var d=Object.keys(e.candidate).length>0?i.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return r();if(d.component&&1!==d.component)return r();if((0===s||s>0&&l.iceTransport!==n.transceivers[0].iceTransport)&&!a(l.iceTransport,d))return o(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=i.getMediaSections(n._remoteDescription.sdp))[s]+="a="+(d.type?p:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=i.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].rejected||(n.transceivers[f].iceTransport.addRemoteCandidate({}),(t=i.getMediaSections(n._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=i.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));f++);r()})},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var i=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&i.push(e[t].getStats())})}),Promise.all(i).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var i=n.prototype.getStats;n.prototype.getStats=function(){return i.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){var i;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(i=e[n]).type]||i.type,t.set(n,e[n])}),t})}}});var d=["createOffer","createAnswer"];return d.forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),l}},{sdp:48}],48:[function(e,t,n){"use strict";var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},i.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},i.getDescription=function(e){var t=i.splitSections(e);return t&&t[0]},i.getMediaSections=function(e){var t=i.splitSections(e);return t.shift(),t},i.matchPrefix=function(e,t){return i.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},i.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},i.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},i.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(t){i.push(e.parameters[t]?t+"="+e.parameters[t]:t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},i.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},i.getIceParameters=function(e,t){var n=i.splitLines(e);return{usernameFragment:(n=n.concat(i.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var o=n[r],s=i.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var a=i.parseRtpMap(s),c=i.matchPrefix(e,"a=fmtp:"+o+" ");switch(a.parameters=c.length?i.parseFmtp(c[0]):{},a.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(i.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(i.parseExtmap(e))}),t},i.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)});var r=0;return t.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),r>0&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=i.writeExtmap(e)}),n},i.parseRtpEncodingParameters=function(e){var t,n=[],r=i.parseRtpParameters(e),o=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,u=i.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(i.rtx={ssrc:t}),n.push(i),o&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:t,mechanism:s?"red+ulpfec":"red"},n.push(i))}}),0===n.length&&c&&n.push({ssrc:c});var l=i.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=l})),n},i.parseRtcpParameters=function(e){var t={},n=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var o=i.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},i.parseMsid=function(e){var t,n=i.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return r.length>0?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||i.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,n,r){var o=i.writeRtpDescription(e.kind,t);if(o+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var s="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),o},i.getDirection=function(e,t){for(var n=i.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},i.parseOLine=function(e){var t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},i.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=i.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=i)},{}],49:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],50:[function(e,t,n){(function(t,i){var r=/%[sdj%]/g;n.format=function(e){if(!g(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,o=i.length,s=String(e).replace(r,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),c=i[n];n<o;c=i[++n])m(c)||!b(c)?s+=" "+c:s+=" "+a(c);return s},n.deprecate=function(e,r){if(y(i.process))return function(){return n.deprecate(e,r).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),o=!0}return e.apply(this,arguments)}};var o,s={};function a(e,t){var i={seen:[],stylize:u};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),h(t)?i.showHidden=t:t&&n._extend(i,t),y(i.showHidden)&&(i.showHidden=!1),y(i.depth)&&(i.depth=2),y(i.colors)&&(i.colors=!1),y(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=c),l(i,e,i.depth)}function c(e,t){var n=a.styles[t];return n?"\x1b["+a.colors[n][0]+"m"+e+"\x1b["+a.colors[n][1]+"m":e}function u(e,t){return e}function l(e,t,i){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(i,e);return g(r)||(r=l(e,r,i)),r}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return v(t)?e.stylize(""+t,"number"):h(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,t);if(o)return o;var s,a=Object.keys(t),c=(s={},a.forEach(function(e,t){s[e]=!0}),s);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),S(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return d(t);if(0===a.length){if(k(t))return e.stylize("[Function"+(t.name?": "+t.name:"")+"]","special");if(_(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(S(t))return d(t)}var u,b="",E=!1,C=["{","}"];return f(t)&&(E=!0,C=["[","]"]),k(t)&&(b=" [Function"+(t.name?": "+t.name:"")+"]"),_(t)&&(b=" "+RegExp.prototype.toString.call(t)),w(t)&&(b=" "+Date.prototype.toUTCString.call(t)),S(t)&&(b=" "+d(t)),0!==a.length||E&&0!=t.length?i<0?_(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=E?function(e,t,n,i,r){for(var o=[],s=0,a=t.length;s<a;++s)x(t,String(s))?o.push(p(e,t,n,i,String(s),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(p(e,t,n,i,r,!0))}),o}(e,t,i,c,a):a.map(function(n){return p(e,t,i,c,n,E)}),e.seen.pop(),function(e,t,n){return e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(u,b,C)):C[0]+b+C[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,i,r,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?a=e.stylize(c.set?"[Getter/Setter]":"[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),x(i,r)||(s="["+r+"]"),a||(e.seen.indexOf(c.value)<0?(a=m(n)?l(e,c.value,null):l(e,c.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),y(s)){if(o&&r.match(/^\d+$/))return a;(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function f(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function v(e){return"number"==typeof e}function g(e){return"string"==typeof e}function y(e){return void 0===e}function _(e){return b(e)&&"[object RegExp]"===E(e)}function b(e){return"object"==typeof e&&null!==e}function w(e){return b(e)&&"[object Date]"===E(e)}function S(e){return b(e)&&("[object Error]"===E(e)||e instanceof Error)}function k(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(y(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var i=t.pid;s[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,i,t)}}else s[e]=function(){};return s[e]},n.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=f,n.isBoolean=h,n.isNull=m,n.isNullOrUndefined=function(e){return null==e},n.isNumber=v,n.isString=g,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=y,n.isRegExp=_,n.isObject=b,n.isDate=w,n.isError=S,n.isFunction=k,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){var e,t;console.log("%s - %s",(t=[C((e=new Date).getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":"),[e.getDate(),T[e.getMonth()],t].join(" ")),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!b(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":49,_process:44,inherits:40}],51:[function(e,t,n){t.exports={name:"twilio-client",version:"1.4.34",description:"Javascript SDK for Twilio Client",homepage:"https://www.twilio.com/docs/client/twilio-js",main:"./es5/twilio.js",license:"Apache-2.0",repository:{type:"git",url:"git@code.hq.twilio.com:client/twiliojs.git"},scripts:{build:"npm-run-all clean docs:ts docs:js build:es5 build:ts build:dist build:dist-min","build:es5":"rimraf ./es5 && babel lib -d es5","build:dist":"node ./scripts/build.js ./lib/browser.js ./LICENSE.md ./dist/twilio.js","build:dist-min":'uglifyjs ./dist/twilio.js -o ./dist/twilio.min.js --comments "/^! twilio-client.js/" -b beautify=false,ascii_only=true',"build:travis":"npm-run-all lint build test:unit test:webpack test:es5","build:ts":"tsc",clean:"rimraf ./coverage ./dist ./es5",coverage:"nyc --reporter=html ./node_modules/mocha/bin/mocha  --reporter=spec tests/index.js","docs:js":"jsdoc -r -d dist/docs/js lib/twilio","docs:ts":"typedoc --out dist/docs/ts lib/twilio",extension:"browserify -t brfs extension/token/index.js > extension/token.js",lint:"npm-run-all lint:js lint:ts","lint:js":"eslint lib","lint:ts":"tslint -c tslint.json --project tsconfig.json -t stylish",release:"release",start:"node server.js",test:"npm-run-all test:unit test:frameworks","test:es5":'es-check es5 "./es5/**/*.js" ./dist/*.js',"test:framework:no-framework":"mocha tests/framework/no-framework.js","test:framework:react:install":"cd ./tests/framework/react && rimraf ./node_modules package-lock.json && npm install","test:framework:react:build":"cd ./tests/framework/react && npm run build","test:framework:react:run":"mocha ./tests/framework/react.js","test:framework:react":"npm-run-all test:framework:react:*","test:frameworks":"npm-run-all test:framework:no-framework test:framework:react","test:selenium":"mocha tests/browser/index.js","test:unit":"mocha --reporter=spec -r ts-node/register ./tests/index.ts","test:webpack":"cd ./tests/webpack && npm install && npm test"},devDependencies:{"@types/mocha":"^5.0.0","@types/node":"^9.6.5","@types/ws":"^4.0.2","babel-cli":"^6.26.0","babel-eslint":"^8.2.2","babel-plugin-transform-class-properties":"^6.24.1","babel-preset-es2015":"^6.24.1",brfs:"^1.4.3",browserify:"^14.3.0",chromedriver:"^2.31.0",envify:"2.0.1","es-check":"^2.0.3",eslint:"^4.19.1","eslint-plugin-babel":"^4.1.2",express:"^4.14.1",geckodriver:"^1.8.1","js-yaml":"^3.9.1",jsdoc:"^3.5.5",jsonwebtoken:"^7.4.3",lodash:"^4.17.4",mocha:"^3.5.0","npm-run-all":"^4.1.2",nyc:"^10.1.2",querystring:"^0.2.0","release-tool":"^0.2.2","selenium-webdriver":"^3.5.0",sinon:"^4.0.0","ts-node":"^6.0.0",tslint:"^5.9.1",twilio:"^3.0.0",typedoc:"^0.11.1",typescript:"^2.8.1","uglify-js":"^3.3.11","vinyl-fs":"^3.0.2","vinyl-source-stream":"^2.0.0"},dependencies:{"@twilio/audioplayer":"^1.0.3",backoff:"^2.5.0","rtcpeerconnection-shim":"^1.2.8",ws:"0.4.31",xmlhttprequest:"^1.8.0"},browser:{xmlhttprequest:"./browser/xmlhttprequest.js",ws:"./browser/ws.js"}}},{}]},{},[3])(3);if("function"==typeof define&&define.amd)define([],function(){return t});else{var n=e.Twilio=e.Twilio||{};n.Connection=n.Connection||t.Connection,n.Device=n.Device||t.Device,n.PStream=n.PStream||t.PStream}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this);